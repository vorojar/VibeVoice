<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qwen3-TTS è¯­éŸ³åˆæˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        cream: '#F9F7F5',
                        'cream-dark': '#F0EDE8',
                        'warm-gray': '#E8E4DE',
                        charcoal: '#2D2D2D',
                        accent: '#D4A373',
                        'accent-dark': '#B8956A',
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .spinner {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid #D4A373;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes pulse-ring {
            0% { box-shadow: 0 0 0 0 rgba(212, 163, 115, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(212, 163, 115, 0); }
            100% { box-shadow: 0 0 0 0 rgba(212, 163, 115, 0); }
        }
        .recording { animation: pulse-ring 1.5s infinite; }
        audio { height: 40px; }
        audio::-webkit-media-controls-panel { background: #F9F7F5; }
    </style>
</head>
<body class="bg-cream min-h-screen">
    <div class="flex min-h-screen">
        <!-- å·¦ä¾§å¯¼èˆª -->
        <aside class="fixed left-0 top-0 bottom-0 w-48 bg-cream-dark/50 p-4 flex flex-col border-r border-warm-gray/50">
            <div class="mb-8">
                <h1 class="text-xl font-bold text-charcoal">Qwen3-TTS</h1>
                <p class="text-xs text-charcoal/50">è¯­éŸ³åˆæˆæœåŠ¡</p>
            </div>

            <nav class="flex-1 space-y-2">
                <div onclick="switchPage('demo')" id="nav-demo"
                    class="px-4 py-3 rounded-xl cursor-pointer flex items-center gap-3 transition-all bg-white shadow-sm text-charcoal font-medium">
                    <span>ğŸ§</span> åœ¨çº¿è¯•ç”¨
                </div>
                <div onclick="switchPage('api')" id="nav-api"
                    class="px-4 py-3 rounded-xl cursor-pointer flex items-center gap-3 transition-all text-charcoal/70 hover:bg-warm-gray/50">
                    <span>ğŸ“¡</span> API æ–‡æ¡£
                </div>
            </nav>

            <div class="pt-4 border-t border-warm-gray/50 text-xs text-charcoal/40">
                Powered by Qwen3-TTS
            </div>
        </aside>

        <!-- ä¸»å†…å®¹åŒº -->
        <main class="flex-1 ml-48 p-6 pb-20">
            <!-- åœ¨çº¿è¯•ç”¨é¡µé¢ -->
            <div id="page-demo" class="max-w-3xl mx-auto">
                <!-- ä¸»æ ‡ç­¾åˆ‡æ¢ -->
        <div class="flex gap-3 mb-6">
            <button onclick="switchTab('custom')" id="tab-custom"
                class="flex-1 px-6 py-3 rounded-xl font-medium transition-all bg-accent text-white">
                ğŸ™ï¸ é¢„è®¾è¯´è¯äºº
            </button>
            <button onclick="switchTab('design')" id="tab-design"
                class="flex-1 px-6 py-3 rounded-xl font-medium transition-all bg-warm-gray text-charcoal/70 hover:bg-accent/20">
                ğŸ¨ å£°éŸ³è®¾è®¡
            </button>
            <button onclick="switchTab('clone')" id="tab-clone"
                class="flex-1 px-6 py-3 rounded-xl font-medium transition-all bg-warm-gray text-charcoal/70 hover:bg-accent/20">
                ğŸ­ è¯­éŸ³å…‹éš†
            </button>
        </div>

        <!-- é¢„è®¾è¯´è¯äººé¢æ¿ -->
        <div id="panel-custom" class="space-y-5">
            <!-- æ–‡æœ¬è¾“å…¥ -->
            <div class="bg-white rounded-2xl p-5 shadow-sm border border-warm-gray/50">
                <h3 class="text-lg font-semibold text-charcoal mb-4 flex items-center gap-2">
                    <span class="w-8 h-8 bg-accent/10 rounded-lg flex items-center justify-center">ğŸ“</span>
                    è¾“å…¥æ–‡æœ¬
                </h3>
                <textarea id="text-custom" rows="3"
                    class="w-full px-4 py-3 bg-white border border-warm-gray rounded-xl text-charcoal placeholder-charcoal/40 focus:outline-none focus:border-accent focus:ring-2 focus:ring-accent/20 transition-all resize-none"
                    placeholder="è¯·è¾“å…¥è¦åˆæˆçš„æ–‡æœ¬...">ä½ å¥½ï¼Œæˆ‘æ˜¯é€šä¹‰åƒé—®è¯­éŸ³åˆæˆæ¨¡å‹ï¼Œå¾ˆé«˜å…´è®¤è¯†ä½ ï¼</textarea>
            </div>

            <!-- è¯­éŸ³è®¾ç½® -->
            <div class="bg-white rounded-2xl p-5 shadow-sm border border-warm-gray/50">
                <h3 class="text-lg font-semibold text-charcoal mb-4 flex items-center gap-2">
                    <span class="w-8 h-8 bg-accent/10 rounded-lg flex items-center justify-center">âš™ï¸</span>
                    è¯­éŸ³è®¾ç½®
                </h3>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-charcoal/70 mb-2">è¯´è¯äºº</label>
                        <select id="speaker"
                            class="w-full px-4 py-3 bg-white border border-warm-gray rounded-xl text-charcoal focus:outline-none focus:border-accent transition-all">
                            <option value="vivian">Vivian (å¥³å£°-ä¸­æ–‡)</option>
                            <option value="uncle_fu">Uncle Fu (ç”·å£°-ä¸­æ–‡)</option>
                            <option value="aiden">Aiden (ç”·å£°-è‹±æ–‡)</option>
                            <option value="serena">Serena (å¥³å£°-è‹±æ–‡)</option>
                            <option value="ono_anna">Ono Anna (å¥³å£°-æ—¥æ–‡)</option>
                            <option value="sohee">Sohee (å¥³å£°-éŸ©æ–‡)</option>
                            <option value="dylan">Dylan (ç”·å£°)</option>
                            <option value="eric">Eric (ç”·å£°)</option>
                            <option value="ryan">Ryan (ç”·å£°)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-charcoal/70 mb-2">è¯­è¨€</label>
                        <select id="language-custom"
                            class="w-full px-4 py-3 bg-white border border-warm-gray rounded-xl text-charcoal focus:outline-none focus:border-accent transition-all">
                            <option value="Chinese">ä¸­æ–‡</option>
                            <option value="English">English</option>
                            <option value="Japanese">æ—¥æœ¬èª</option>
                            <option value="Korean">í•œêµ­ì–´</option>
                            <option value="German">Deutsch</option>
                            <option value="French">FranÃ§ais</option>
                            <option value="Spanish">EspaÃ±ol</option>
                            <option value="Russian">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                            <option value="Portuguese">PortuguÃªs</option>
                            <option value="Italian">Italiano</option>
                        </select>
                    </div>
                </div>
                <div class="mt-4">
                    <label class="block text-sm font-medium text-charcoal/70 mb-2">æƒ…æ„ŸæŒ‡ä»¤ï¼ˆå¯é€‰ï¼‰</label>
                    <input type="text" id="instruct"
                        class="w-full px-4 py-3 bg-white border border-warm-gray rounded-xl text-charcoal placeholder-charcoal/40 focus:outline-none focus:border-accent focus:ring-2 focus:ring-accent/20 transition-all"
                        placeholder="ä¾‹å¦‚ï¼šç”¨å¼€å¿ƒçš„è¯­æ°”è¯´ã€ç”¨æ‚²ä¼¤çš„è¯­æ°”è¯´">
                </div>
            </div>

            <!-- ç”ŸæˆæŒ‰é’® -->
            <div class="flex gap-3">
                <button onclick="generateCustom()" id="btn-custom"
                    class="flex-1 py-4 bg-accent hover:bg-accent-dark text-white font-semibold rounded-xl transition-all shadow-sm hover:shadow-md">
                    ç”Ÿæˆè¯­éŸ³
                </button>
            </div>

            <!-- çŠ¶æ€å’Œç»“æœ -->
            <div id="status-custom" class="text-center text-sm text-charcoal/60"></div>
            <div id="audio-container-custom" class="hidden bg-white rounded-2xl p-5 shadow-sm border border-warm-gray/50">
                <h3 class="text-lg font-semibold text-charcoal mb-3 flex items-center gap-2">
                    <span class="w-8 h-8 bg-accent/10 rounded-lg flex items-center justify-center">ğŸ”Š</span>
                    ç”Ÿæˆç»“æœ
                </h3>
                <audio id="audio-custom" controls class="w-full"></audio>
            </div>

            <!-- ç¤ºä¾‹ -->
            <div class="flex gap-2 flex-wrap">
                <span class="text-sm text-charcoal/50">å¿«é€Ÿç¤ºä¾‹ï¼š</span>
                <button onclick="setCustomExample('ä½ å¥½ï¼Œæ¬¢è¿ä½¿ç”¨é€šä¹‰åƒé—®è¯­éŸ³åˆæˆç³»ç»Ÿï¼', 'vivian', 'Chinese')"
                    class="px-3 py-1 bg-cream-dark rounded-lg text-sm text-charcoal/70 hover:bg-warm-gray transition-all">ä¸­æ–‡é—®å€™</button>
                <button onclick="setCustomExample('Hello! Welcome to Qwen Text-to-Speech!', 'aiden', 'English')"
                    class="px-3 py-1 bg-cream-dark rounded-lg text-sm text-charcoal/70 hover:bg-warm-gray transition-all">è‹±æ–‡é—®å€™</button>
                <button onclick="setCustomExample('ã“ã‚“ã«ã¡ã¯ã€ç§ã¯Qwenã§ã™ã€‚', 'ono_anna', 'Japanese')"
                    class="px-3 py-1 bg-cream-dark rounded-lg text-sm text-charcoal/70 hover:bg-warm-gray transition-all">æ—¥æ–‡é—®å€™</button>
            </div>
        </div>

        <!-- å£°éŸ³è®¾è®¡é¢æ¿ -->
        <div id="panel-design" class="hidden space-y-5">
            <!-- å£°éŸ³æè¿° -->
            <div class="bg-white rounded-2xl p-5 shadow-sm border border-warm-gray/50">
                <h3 class="text-lg font-semibold text-charcoal mb-4 flex items-center gap-2">
                    <span class="w-8 h-8 bg-accent/10 rounded-lg flex items-center justify-center">ğŸ¨</span>
                    å£°éŸ³æè¿°
                </h3>
                <textarea id="instruct-design" rows="3"
                    class="w-full px-4 py-3 bg-white border border-warm-gray rounded-xl text-charcoal placeholder-charcoal/40 focus:outline-none focus:border-accent focus:ring-2 focus:ring-accent/20 transition-all resize-none"
                    placeholder="ç”¨è‡ªç„¶è¯­è¨€æè¿°ä½ æƒ³è¦çš„å£°éŸ³ï¼Œä¾‹å¦‚ï¼šä½æ²‰æ²™å“‘çš„ä¸­å¹´ç”·å£°ã€æ¸©æŸ”ç”œç¾çš„å°‘å¥³å£°..."></textarea>
                <div class="flex gap-2 flex-wrap mt-3">
                    <span class="text-xs text-charcoal/50">å¿«é€Ÿé€‰æ‹©ï¼š</span>
                    <button onclick="setDesignExample('ä½æ²‰æ²™å“‘çš„ä¸­å¹´ç”·å£°ï¼Œè¯­é€Ÿåæ…¢')"
                        class="px-2 py-1 bg-cream-dark rounded text-xs text-charcoal/70 hover:bg-warm-gray transition-all">æˆç†Ÿç”·å£°</button>
                    <button onclick="setDesignExample('æ¸©æŸ”ç”œç¾çš„å°‘å¥³å£°ï¼ŒéŸ³è°ƒåé«˜ï¼Œè¯­æ°”æ´»æ³¼')"
                        class="px-2 py-1 bg-cream-dark rounded text-xs text-charcoal/70 hover:bg-warm-gray transition-all">ç”œç¾å°‘å¥³</button>
                    <button onclick="setDesignExample('ä½“ç°æ’’å¨‡ç¨šå«©çš„èè‰å¥³å£°ï¼ŒéŸ³è°ƒåé«˜ä¸”èµ·ä¼æ˜æ˜¾')"
                        class="px-2 py-1 bg-cream-dark rounded text-xs text-charcoal/70 hover:bg-warm-gray transition-all">èè‰éŸ³</button>
                    <button onclick="setDesignExample('A deep, authoritative male voice with clear pronunciation')"
                        class="px-2 py-1 bg-cream-dark rounded text-xs text-charcoal/70 hover:bg-warm-gray transition-all">æƒå¨ç”·å£°</button>
                    <button onclick="setDesignExample('A cheerful young female voice with a warm, friendly tone')"
                        class="px-2 py-1 bg-cream-dark rounded text-xs text-charcoal/70 hover:bg-warm-gray transition-all">æ´»æ³¼å¥³å£°</button>
                </div>
            </div>

            <!-- åˆæˆè®¾ç½® -->
            <div class="bg-white rounded-2xl p-5 shadow-sm border border-warm-gray/50">
                <h3 class="text-lg font-semibold text-charcoal mb-4 flex items-center gap-2">
                    <span class="w-8 h-8 bg-accent/10 rounded-lg flex items-center justify-center">ğŸ“</span>
                    åˆæˆè®¾ç½®
                </h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-charcoal/70 mb-2">è¦åˆæˆçš„æ–‡æœ¬</label>
                        <textarea id="text-design" rows="2"
                            class="w-full px-4 py-3 bg-white border border-warm-gray rounded-xl text-charcoal placeholder-charcoal/40 focus:outline-none focus:border-accent focus:ring-2 focus:ring-accent/20 transition-all resize-none"
                            placeholder="è¯·è¾“å…¥è¦åˆæˆçš„æ–‡æœ¬...">ä½ å¥½ï¼Œæˆ‘æ˜¯æ ¹æ®ä½ çš„æè¿°ç”Ÿæˆçš„å£°éŸ³ã€‚</textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-charcoal/70 mb-2">è¯­è¨€</label>
                        <select id="language-design"
                            class="w-full px-4 py-3 bg-white border border-warm-gray rounded-xl text-charcoal focus:outline-none focus:border-accent transition-all">
                            <option value="Chinese">ä¸­æ–‡</option>
                            <option value="English">English</option>
                            <option value="Japanese">æ—¥æœ¬èª</option>
                            <option value="Korean">í•œêµ­ì–´</option>
                            <option value="German">Deutsch</option>
                            <option value="French">FranÃ§ais</option>
                            <option value="Spanish">EspaÃ±ol</option>
                            <option value="Russian">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                            <option value="Portuguese">PortuguÃªs</option>
                            <option value="Italian">Italiano</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- ç”ŸæˆæŒ‰é’® -->
            <button onclick="generateDesign()" id="btn-design"
                class="w-full py-4 bg-accent hover:bg-accent-dark text-white font-semibold rounded-xl transition-all shadow-sm hover:shadow-md">
                ç”Ÿæˆå£°éŸ³
            </button>

            <!-- çŠ¶æ€å’Œç»“æœ -->
            <div id="status-design" class="text-center text-sm text-charcoal/60"></div>
            <div id="audio-container-design" class="hidden bg-white rounded-2xl p-5 shadow-sm border border-warm-gray/50">
                <h3 class="text-lg font-semibold text-charcoal mb-3 flex items-center gap-2">
                    <span class="w-8 h-8 bg-accent/10 rounded-lg flex items-center justify-center">ğŸ”Š</span>
                    ç”Ÿæˆç»“æœ
                </h3>
                <audio id="audio-design" controls class="w-full"></audio>
            </div>
        </div>

        <!-- è¯­éŸ³å…‹éš†é¢æ¿ -->
        <div id="panel-clone" class="hidden space-y-5">
            <!-- å£°éŸ³åº“ -->
            <div class="bg-white rounded-2xl p-5 shadow-sm border border-warm-gray/50">
                <h3 class="text-lg font-semibold text-charcoal mb-4 flex items-center gap-2">
                    <span class="w-8 h-8 bg-accent/10 rounded-lg flex items-center justify-center">ğŸ’¾</span>
                    æˆ‘çš„å£°éŸ³åº“
                </h3>
                <div id="voice-list" class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                    <div id="no-voices" class="col-span-full text-center py-6 text-charcoal/40 text-sm">
                        æš‚æ— ä¿å­˜çš„å£°éŸ³
                    </div>
                </div>
            </div>

            <!-- æ–°å»ºå…‹éš† -->
            <div class="bg-white rounded-2xl p-5 shadow-sm border border-warm-gray/50">
                <h3 class="text-lg font-semibold text-charcoal mb-4 flex items-center gap-2">
                    <span class="w-8 h-8 bg-accent/10 rounded-lg flex items-center justify-center">ğŸ¤</span>
                    å‚è€ƒéŸ³é¢‘
                </h3>

                <!-- æ“ä½œæŒ‰é’® -->
                <div class="flex gap-3 mb-4">
                    <button onclick="toggleRecording()" id="record-btn"
                        class="flex-1 px-4 py-3 rounded-xl font-medium transition-all bg-red-500 hover:bg-red-600 text-white flex items-center justify-center gap-2">
                        <span id="record-icon">ğŸ™ï¸</span>
                        <span id="record-text">å½•éŸ³</span>
                    </button>
                    <button onclick="document.getElementById('ref-audio').click()"
                        class="flex-1 px-4 py-3 rounded-xl font-medium transition-all bg-warm-gray hover:bg-charcoal/10 text-charcoal/70 flex items-center justify-center gap-2">
                        ğŸ“ ä¸Šä¼ æ–‡ä»¶
                    </button>
                    <input type="file" id="ref-audio" accept="audio/*" onchange="handleFileSelect(this)" class="hidden">
                </div>

                <!-- å½•éŸ³è®¡æ—¶å™¨ -->
                <div id="record-timer-row" class="hidden flex items-center gap-3 mb-4 p-3 bg-red-50 rounded-xl">
                    <div class="w-3 h-3 bg-red-500 rounded-full animate-pulse"></div>
                    <span class="text-red-600 font-medium">æ­£åœ¨å½•éŸ³</span>
                    <span id="record-timer" class="text-red-500 font-bold">00:00</span>
                </div>

                <!-- éŸ³é¢‘é¢„è§ˆ -->
                <div id="audio-preview-row" class="hidden flex items-center gap-3 p-3 bg-cream-dark rounded-xl">
                    <audio id="audio-preview" controls class="flex-1 h-10"></audio>
                    <button onclick="clearAudio()" class="px-3 py-1.5 text-charcoal/50 hover:text-red-500 text-sm transition-all">æ¸…é™¤</button>
                </div>

                <!-- å‚è€ƒæ–‡æœ¬ -->
                <div class="mt-4">
                    <label class="block text-sm font-medium text-charcoal/70 mb-2">å‚è€ƒéŸ³é¢‘æ–‡å­—å†…å®¹ï¼ˆå¯é€‰ï¼Œå¯æé«˜è´¨é‡ï¼‰</label>
                    <input type="text" id="ref-text"
                        class="w-full px-4 py-3 bg-white border border-warm-gray rounded-xl text-charcoal placeholder-charcoal/40 focus:outline-none focus:border-accent focus:ring-2 focus:ring-accent/20 transition-all"
                        placeholder="è¾“å…¥å‚è€ƒéŸ³é¢‘ä¸­è¯´çš„è¯...">
                </div>
            </div>

            <!-- åˆæˆè®¾ç½® -->
            <div class="bg-white rounded-2xl p-5 shadow-sm border border-warm-gray/50">
                <h3 class="text-lg font-semibold text-charcoal mb-4 flex items-center gap-2">
                    <span class="w-8 h-8 bg-accent/10 rounded-lg flex items-center justify-center">ğŸ“</span>
                    åˆæˆè®¾ç½®
                </h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-charcoal/70 mb-2">è¦åˆæˆçš„æ–‡æœ¬</label>
                        <textarea id="text-clone" rows="2"
                            class="w-full px-4 py-3 bg-white border border-warm-gray rounded-xl text-charcoal placeholder-charcoal/40 focus:outline-none focus:border-accent focus:ring-2 focus:ring-accent/20 transition-all resize-none"
                            placeholder="è¯·è¾“å…¥è¦ç”¨å…‹éš†å£°éŸ³æœ—è¯»çš„æ–‡æœ¬...">ä½ å¥½ï¼Œè¿™æ˜¯ä½¿ç”¨è¯­éŸ³å…‹éš†æŠ€æœ¯ç”Ÿæˆçš„è¯­éŸ³ã€‚</textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-charcoal/70 mb-2">è¯­è¨€</label>
                        <select id="language-clone"
                            class="w-full px-4 py-3 bg-white border border-warm-gray rounded-xl text-charcoal focus:outline-none focus:border-accent transition-all">
                            <option value="Chinese">ä¸­æ–‡</option>
                            <option value="English">English</option>
                            <option value="Japanese">æ—¥æœ¬èª</option>
                            <option value="Korean">í•œêµ­ì–´</option>
                            <option value="German">Deutsch</option>
                            <option value="French">FranÃ§ais</option>
                            <option value="Spanish">EspaÃ±ol</option>
                            <option value="Russian">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                            <option value="Portuguese">PortuguÃªs</option>
                            <option value="Italian">Italiano</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- ç”ŸæˆæŒ‰é’® -->
            <button onclick="generateClone()" id="btn-clone"
                class="w-full py-4 bg-accent hover:bg-accent-dark text-white font-semibold rounded-xl transition-all shadow-sm hover:shadow-md">
                å…‹éš†å¹¶ç”Ÿæˆè¯­éŸ³
            </button>

            <!-- çŠ¶æ€å’Œç»“æœ -->
            <div id="status-clone" class="text-center text-sm text-charcoal/60"></div>
            <div id="audio-container-clone" class="hidden bg-white rounded-2xl p-5 shadow-sm border border-warm-gray/50">
                <h3 class="text-lg font-semibold text-charcoal mb-3 flex items-center gap-2">
                    <span class="w-8 h-8 bg-accent/10 rounded-lg flex items-center justify-center">ğŸ”Š</span>
                    ç”Ÿæˆç»“æœ
                </h3>
                <audio id="audio-clone" controls class="w-full"></audio>
                <div class="flex gap-2 mt-4">
                    <input type="text" id="voice-name"
                        class="flex-1 px-4 py-2 bg-white border border-warm-gray rounded-xl text-charcoal placeholder-charcoal/40 focus:outline-none focus:border-accent transition-all text-sm"
                        placeholder="è¾“å…¥åç§°ä¿å­˜åˆ°å£°éŸ³åº“">
                    <button onclick="saveVoice()" class="px-4 py-2 bg-warm-gray text-charcoal/70 rounded-xl text-sm font-medium hover:bg-charcoal/10 transition-all">
                        ä¿å­˜
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- API æ–‡æ¡£é¡µé¢ -->
    <div id="page-api" class="hidden max-w-3xl mx-auto space-y-6">
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-warm-gray/50">
                    <h2 class="text-2xl font-bold text-charcoal mb-2">API æ–‡æ¡£</h2>
                    <p class="text-charcoal/60">é€šè¿‡ HTTP API é›†æˆè¯­éŸ³åˆæˆèƒ½åŠ›åˆ°ä½ çš„åº”ç”¨ä¸­</p>
                </div>

                <!-- é¢„è®¾è¯´è¯äºº API -->
                <div class="bg-white rounded-2xl p-5 shadow-sm border border-warm-gray/50">
                    <h3 class="text-lg font-semibold text-charcoal mb-4 flex items-center gap-2">
                        <span class="w-8 h-8 bg-accent/10 rounded-lg flex items-center justify-center">ğŸ™ï¸</span>
                        é¢„è®¾è¯´è¯äºº TTS
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <div class="flex items-center gap-2 mb-2">
                                <span class="px-2 py-1 bg-green-100 text-green-700 text-xs font-medium rounded">GET</span>
                                <code class="text-sm text-charcoal">/tts</code>
                            </div>
                            <div class="bg-charcoal rounded-xl p-4 overflow-x-auto">
                                <pre class="text-sm text-green-400"><code>curl "http://localhost:8000/tts?text=ä½ å¥½ä¸–ç•Œ&speaker=vivian&language=Chinese" --output audio.wav</code></pre>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <p class="font-medium text-charcoal mb-1">å‚æ•°</p>
                                <ul class="text-charcoal/70 space-y-1">
                                    <li><code class="bg-cream-dark px-1 rounded">text</code> - è¦åˆæˆçš„æ–‡æœ¬</li>
                                    <li><code class="bg-cream-dark px-1 rounded">speaker</code> - è¯´è¯äºº</li>
                                    <li><code class="bg-cream-dark px-1 rounded">language</code> - è¯­è¨€</li>
                                    <li><code class="bg-cream-dark px-1 rounded">instruct</code> - æƒ…æ„ŸæŒ‡ä»¤ï¼ˆå¯é€‰ï¼‰</li>
                                </ul>
                            </div>
                            <div>
                                <p class="font-medium text-charcoal mb-1">è¯´è¯äººåˆ—è¡¨</p>
                                <p class="text-charcoal/70">vivian, uncle_fu, aiden, serena, ono_anna, sohee, dylan, eric, ryan</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- è¯­éŸ³å…‹éš† API -->
                <div class="bg-white rounded-2xl p-5 shadow-sm border border-warm-gray/50">
                    <h3 class="text-lg font-semibold text-charcoal mb-4 flex items-center gap-2">
                        <span class="w-8 h-8 bg-accent/10 rounded-lg flex items-center justify-center">ğŸ­</span>
                        è¯­éŸ³å…‹éš†
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <div class="flex items-center gap-2 mb-2">
                                <span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded">POST</span>
                                <code class="text-sm text-charcoal">/clone</code>
                            </div>
                            <div class="bg-charcoal rounded-xl p-4 overflow-x-auto">
                                <pre class="text-sm text-green-400"><code>curl -X POST "http://localhost:8000/clone" \
  -F "audio=@reference.wav" \
  -F "text=è¦åˆæˆçš„æ–‡æœ¬" \
  -F "language=Chinese" \
  -F "ref_text=å‚è€ƒéŸ³é¢‘å†…å®¹" \
  --output clone.wav</code></pre>
                            </div>
                        </div>
                        <div class="text-sm">
                            <p class="font-medium text-charcoal mb-1">å‚æ•°</p>
                            <ul class="text-charcoal/70 space-y-1">
                                <li><code class="bg-cream-dark px-1 rounded">audio</code> - å‚è€ƒéŸ³é¢‘æ–‡ä»¶ï¼ˆ3-10ç§’ï¼‰</li>
                                <li><code class="bg-cream-dark px-1 rounded">text</code> - è¦åˆæˆçš„æ–‡æœ¬</li>
                                <li><code class="bg-cream-dark px-1 rounded">language</code> - è¯­è¨€</li>
                                <li><code class="bg-cream-dark px-1 rounded">ref_text</code> - å‚è€ƒéŸ³é¢‘æ–‡å­—å†…å®¹ï¼ˆå¯é€‰ï¼Œæä¾›å¯æé«˜è´¨é‡ï¼‰</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- å£°éŸ³åº“ API -->
                <div class="bg-white rounded-2xl p-5 shadow-sm border border-warm-gray/50">
                    <h3 class="text-lg font-semibold text-charcoal mb-4 flex items-center gap-2">
                        <span class="w-8 h-8 bg-accent/10 rounded-lg flex items-center justify-center">ğŸ’¾</span>
                        å£°éŸ³åº“ç®¡ç†
                    </h3>
                    <div class="space-y-4 text-sm">
                        <div class="flex items-center gap-3 p-3 bg-cream-dark rounded-xl">
                            <span class="px-2 py-1 bg-green-100 text-green-700 text-xs font-medium rounded">GET</span>
                            <code class="text-charcoal">/voices</code>
                            <span class="text-charcoal/50">è·å–å·²ä¿å­˜çš„å£°éŸ³åˆ—è¡¨</span>
                        </div>
                        <div class="flex items-center gap-3 p-3 bg-cream-dark rounded-xl">
                            <span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded">POST</span>
                            <code class="text-charcoal">/voices/save</code>
                            <span class="text-charcoal/50">ä¿å­˜å£°éŸ³åˆ°å£°éŸ³åº“</span>
                        </div>
                        <div class="flex items-center gap-3 p-3 bg-cream-dark rounded-xl">
                            <span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded">POST</span>
                            <code class="text-charcoal">/voices/{'{voice_id}'}/tts</code>
                            <span class="text-charcoal/50">ä½¿ç”¨å·²ä¿å­˜å£°éŸ³ç”Ÿæˆè¯­éŸ³</span>
                        </div>
                        <div class="flex items-center gap-3 p-3 bg-cream-dark rounded-xl">
                            <span class="px-2 py-1 bg-red-100 text-red-700 text-xs font-medium rounded">DELETE</span>
                            <code class="text-charcoal">/voices/{'{voice_id}'}</code>
                            <span class="text-charcoal/50">åˆ é™¤å·²ä¿å­˜çš„å£°éŸ³</span>
                        </div>
                    </div>
                </div>

                <!-- å…¶ä»–æ¥å£ -->
                <div class="bg-white rounded-2xl p-5 shadow-sm border border-warm-gray/50">
                    <h3 class="text-lg font-semibold text-charcoal mb-4 flex items-center gap-2">
                        <span class="w-8 h-8 bg-accent/10 rounded-lg flex items-center justify-center">ğŸ“‹</span>
                        å…¶ä»–æ¥å£
                    </h3>
                    <div class="space-y-3 text-sm">
                        <div class="flex items-center gap-3 p-3 bg-cream-dark rounded-xl">
                            <span class="px-2 py-1 bg-green-100 text-green-700 text-xs font-medium rounded">GET</span>
                            <code class="text-charcoal">/speakers</code>
                            <span class="text-charcoal/50">è·å–å¯ç”¨è¯´è¯äººåˆ—è¡¨</span>
                        </div>
                        <div class="flex items-center gap-3 p-3 bg-cream-dark rounded-xl">
                            <span class="px-2 py-1 bg-green-100 text-green-700 text-xs font-medium rounded">GET</span>
                            <code class="text-charcoal">/languages</code>
                            <span class="text-charcoal/50">è·å–æ”¯æŒçš„è¯­è¨€åˆ—è¡¨</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- éšè—çš„é¢„è§ˆéŸ³é¢‘ -->
    <audio id="voice-preview-audio" class="hidden"></audio>

    <script>
        let selectedFile = null;
        let recordedBlob = null;
        let mediaRecorder = null;
        let audioChunks = [];
        let recordingStartTime = null;
        let timerInterval = null;
        let audioSource = 'record';
        let savedVoices = [];
        let selectedVoiceId = null;

        // æ¨¡å‹åŠ è½½çŠ¶æ€ç¼“å­˜
        let modelStatusCache = { custom: 'unloaded', design: 'unloaded', clone: 'unloaded' };

        // ç¡®ä¿æ¨¡å‹å·²åŠ è½½
        async function ensureModelLoaded(modelType, statusEl, btnEl) {
            // å…ˆæ£€æŸ¥çŠ¶æ€
            const statusRes = await fetch('/model/status');
            const statusData = await statusRes.json();
            modelStatusCache = statusData.status;

            if (modelStatusCache[modelType] === 'loaded') {
                return true;
            }

            // è§¦å‘åŠ è½½
            statusEl.textContent = 'æ­£åœ¨åŠ è½½æ¨¡å‹ï¼Œè¯·ç¨å€™...';
            statusEl.classList.remove('text-red-500');
            btnEl.innerHTML = '<span class="spinner"></span> åŠ è½½æ¨¡å‹ä¸­...';

            await fetch(`/model/load/${modelType}`, { method: 'POST' });

            // è½®è¯¢ç­‰å¾…åŠ è½½å®Œæˆ
            let attempts = 0;
            const maxAttempts = 120; // æœ€å¤šç­‰å¾…2åˆ†é’Ÿ
            while (attempts < maxAttempts) {
                await new Promise(r => setTimeout(r, 1000)); // æ¯ç§’æ£€æŸ¥ä¸€æ¬¡
                const checkRes = await fetch('/model/status');
                const checkData = await checkRes.json();
                modelStatusCache = checkData.status;

                if (modelStatusCache[modelType] === 'loaded') {
                    statusEl.textContent = 'æ¨¡å‹åŠ è½½å®Œæˆ';
                    return true;
                } else if (modelStatusCache[modelType] === 'unloaded') {
                    // åŠ è½½å¤±è´¥
                    statusEl.textContent = 'æ¨¡å‹åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•';
                    statusEl.classList.add('text-red-500');
                    return false;
                }

                // æ›´æ–°è¿›åº¦æç¤º
                attempts++;
                statusEl.textContent = `æ­£åœ¨åŠ è½½æ¨¡å‹... (${attempts}ç§’)`;
            }

            statusEl.textContent = 'æ¨¡å‹åŠ è½½è¶…æ—¶ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•';
            statusEl.classList.add('text-red-500');
            return false;
        }

        // é¡µé¢åŠ è½½
        document.addEventListener('DOMContentLoaded', loadSavedVoices);

        function switchPage(page) {
            // æ›´æ–°å¯¼èˆªæ ·å¼
            document.getElementById('nav-demo').className = page === 'demo'
                ? 'px-4 py-3 rounded-xl cursor-pointer flex items-center gap-3 transition-all bg-white shadow-sm text-charcoal font-medium'
                : 'px-4 py-3 rounded-xl cursor-pointer flex items-center gap-3 transition-all text-charcoal/70 hover:bg-warm-gray/50';
            document.getElementById('nav-api').className = page === 'api'
                ? 'px-4 py-3 rounded-xl cursor-pointer flex items-center gap-3 transition-all bg-white shadow-sm text-charcoal font-medium'
                : 'px-4 py-3 rounded-xl cursor-pointer flex items-center gap-3 transition-all text-charcoal/70 hover:bg-warm-gray/50';
            // åˆ‡æ¢é¡µé¢
            document.getElementById('page-demo').className = page === 'demo' ? 'max-w-3xl mx-auto' : 'hidden';
            document.getElementById('page-api').className = page === 'api' ? 'max-w-3xl mx-auto space-y-6' : 'hidden';
        }

        async function loadSavedVoices() {
            try {
                const response = await fetch('/voices');
                const data = await response.json();
                savedVoices = data.voices || [];
                renderVoiceList();
            } catch (error) {
                console.error('åŠ è½½å£°éŸ³åº“å¤±è´¥:', error);
            }
        }

        function renderVoiceList() {
            const container = document.getElementById('voice-list');
            if (savedVoices.length === 0) {
                container.innerHTML = '<div class="col-span-full text-center py-6 text-charcoal/40 text-sm">æš‚æ— ä¿å­˜çš„å£°éŸ³</div>';
                return;
            }
            container.innerHTML = savedVoices.map(voice => `
                <div class="relative p-3 rounded-xl border-2 cursor-pointer transition-all ${selectedVoiceId === voice.id ? 'border-accent bg-accent/5' : 'border-warm-gray hover:border-accent/50'}"
                     onclick="selectVoice('${voice.id}')">
                    <div class="font-medium text-charcoal text-sm truncate pr-12">${voice.name}</div>
                    <div class="text-xs text-charcoal/50 mt-1">${voice.language}</div>
                    <div class="absolute top-2 right-2 flex gap-1">
                        <button onclick="event.stopPropagation(); previewVoice('${voice.id}')"
                            class="w-6 h-6 rounded bg-accent/10 text-accent text-xs flex items-center justify-center hover:bg-accent/20">â–¶</button>
                        <button onclick="event.stopPropagation(); deleteVoice('${voice.id}')"
                            class="w-6 h-6 rounded bg-red-50 text-red-400 text-xs flex items-center justify-center hover:bg-red-100">Ã—</button>
                    </div>
                </div>
            `).join('');
        }

        function selectVoice(voiceId) {
            selectedVoiceId = selectedVoiceId === voiceId ? null : voiceId;
            renderVoiceList();
        }

        async function previewVoice(voiceId) {
            const audio = document.getElementById('voice-preview-audio');
            audio.src = `/voices/${voiceId}/preview`;
            audio.play();
        }

        async function deleteVoice(voiceId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå£°éŸ³å—ï¼Ÿ')) return;
            try {
                const response = await fetch(`/voices/${voiceId}`, { method: 'DELETE' });
                if (response.ok) {
                    if (selectedVoiceId === voiceId) selectedVoiceId = null;
                    await loadSavedVoices();
                }
            } catch (error) {
                alert('åˆ é™¤å¤±è´¥: ' + error.message);
            }
        }

        async function saveVoice() {
            const name = document.getElementById('voice-name').value.trim();
            const language = document.getElementById('language-clone').value;
            const refText = document.getElementById('ref-text').value.trim();

            if (!name) { alert('è¯·è¾“å…¥å£°éŸ³åç§°'); return; }

            let audioFile = null;
            if (audioSource === 'record') {
                if (!recordedBlob) { alert('è¯·å…ˆå½•åˆ¶å‚è€ƒéŸ³é¢‘'); return; }
                audioFile = new File([recordedBlob], 'recording.webm', { type: 'audio/webm' });
            } else {
                if (!selectedFile) { alert('è¯·å…ˆä¸Šä¼ å‚è€ƒéŸ³é¢‘'); return; }
                audioFile = selectedFile;
            }

            const formData = new FormData();
            formData.append('name', name);
            formData.append('language', language);
            formData.append('ref_text', refText);
            formData.append('audio', audioFile);

            const btn = document.querySelector('#audio-container-clone button:last-child');
            btn.disabled = true;
            btn.textContent = 'ä¿å­˜ä¸­...';

            try {
                const response = await fetch('/voices/save', { method: 'POST', body: formData });
                if (response.ok) {
                    document.getElementById('voice-name').value = '';
                    btn.textContent = 'å·²ä¿å­˜';
                    await loadSavedVoices();
                    setTimeout(() => { btn.textContent = 'ä¿å­˜'; }, 2000);
                } else {
                    throw new Error((await response.json()).detail || 'ä¿å­˜å¤±è´¥');
                }
            } catch (error) {
                alert('ä¿å­˜å¤±è´¥: ' + error.message);
                btn.textContent = 'ä¿å­˜';
            } finally {
                btn.disabled = false;
            }
        }

        function switchTab(tab) {
            const activeClass = 'flex-1 px-6 py-3 rounded-xl font-medium transition-all bg-accent text-white';
            const inactiveClass = 'flex-1 px-6 py-3 rounded-xl font-medium transition-all bg-warm-gray text-charcoal/70 hover:bg-accent/20';
            document.getElementById('tab-custom').className = tab === 'custom' ? activeClass : inactiveClass;
            document.getElementById('tab-design').className = tab === 'design' ? activeClass : inactiveClass;
            document.getElementById('tab-clone').className = tab === 'clone' ? activeClass : inactiveClass;
            document.getElementById('panel-custom').className = tab === 'custom' ? 'space-y-5' : 'hidden space-y-5';
            document.getElementById('panel-design').className = tab === 'design' ? 'space-y-5' : 'hidden space-y-5';
            document.getElementById('panel-clone').className = tab === 'clone' ? 'space-y-5' : 'hidden space-y-5';
        }

        function setDesignExample(instruct) {
            document.getElementById('instruct-design').value = instruct;
        }

        async function generateDesign() {
            const text = document.getElementById('text-design').value.trim();
            const language = document.getElementById('language-design').value;
            const instruct = document.getElementById('instruct-design').value.trim();
            const btn = document.getElementById('btn-design');
            const status = document.getElementById('status-design');
            const container = document.getElementById('audio-container-design');
            const audio = document.getElementById('audio-design');

            if (!instruct) { status.textContent = 'è¯·è¾“å…¥å£°éŸ³æè¿°'; status.classList.add('text-red-500'); return; }
            if (!text) { status.textContent = 'è¯·è¾“å…¥è¦åˆæˆçš„æ–‡æœ¬'; status.classList.add('text-red-500'); return; }

            btn.disabled = true;
            status.textContent = '';
            container.classList.add('hidden');

            // ç¡®ä¿æ¨¡å‹å·²åŠ è½½
            const modelReady = await ensureModelLoaded('design', status, btn);
            if (!modelReady) {
                btn.disabled = false;
                btn.textContent = 'ç”Ÿæˆå£°éŸ³';
                return;
            }

            btn.innerHTML = '<span class="spinner"></span> ç”Ÿæˆä¸­...';
            status.textContent = '';

            try {
                const formData = new FormData();
                formData.append('text', text);
                formData.append('language', language);
                formData.append('instruct', instruct);

                const response = await fetch('/design', { method: 'POST', body: formData });
                if (!response.ok) throw new Error((await response.json()).detail || 'ç”Ÿæˆå¤±è´¥');

                audio.src = URL.createObjectURL(await response.blob());
                container.classList.remove('hidden');
                audio.play();
                status.textContent = 'ç”ŸæˆæˆåŠŸ';
                status.classList.remove('text-red-500');
            } catch (error) {
                status.textContent = 'ç”Ÿæˆå¤±è´¥: ' + error.message;
                status.classList.add('text-red-500');
            } finally {
                btn.disabled = false;
                btn.textContent = 'ç”Ÿæˆå£°éŸ³';
            }
        }

        async function toggleRecording() {
            const btn = document.getElementById('record-btn');
            const icon = document.getElementById('record-icon');
            const text = document.getElementById('record-text');
            const timerRow = document.getElementById('record-timer-row');
            const timer = document.getElementById('record-timer');

            if (!mediaRecorder || mediaRecorder.state === 'inactive') {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream, { mimeType: 'audio/webm' });
                    audioChunks = [];

                    mediaRecorder.ondataavailable = (e) => { if (e.data.size > 0) audioChunks.push(e.data); };
                    mediaRecorder.onstop = () => {
                        stream.getTracks().forEach(track => track.stop());
                        recordedBlob = new Blob(audioChunks, { type: 'audio/webm' });
                        selectedFile = null; // æ¸…é™¤ä¸Šä¼ çš„æ–‡ä»¶ï¼Œä½¿ç”¨å½•éŸ³
                        audioSource = 'record';
                        showAudioPreview(URL.createObjectURL(recordedBlob));
                        timerRow.classList.add('hidden');
                        icon.textContent = 'ğŸ™ï¸';
                        text.textContent = 'å½•éŸ³';
                        btn.classList.remove('bg-charcoal', 'hover:bg-charcoal/80');
                        btn.classList.add('bg-red-500', 'hover:bg-red-600');
                        clearInterval(timerInterval);
                    };

                    mediaRecorder.start();
                    recordingStartTime = Date.now();
                    icon.textContent = 'â¹';
                    text.textContent = 'åœæ­¢';
                    btn.classList.remove('bg-red-500', 'hover:bg-red-600');
                    btn.classList.add('bg-charcoal', 'hover:bg-charcoal/80');
                    timerRow.classList.remove('hidden');
                    timer.textContent = '00:00';

                    timerInterval = setInterval(() => {
                        const elapsed = Math.floor((Date.now() - recordingStartTime) / 1000);
                        timer.textContent = `${String(Math.floor(elapsed / 60)).padStart(2, '0')}:${String(elapsed % 60).padStart(2, '0')}`;
                    }, 100);
                } catch (err) {
                    alert('æ— æ³•è®¿é—®éº¦å…‹é£: ' + err.message);
                }
            } else if (mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
            }
        }

        function handleFileSelect(input) {
            const file = input.files[0];
            if (file) {
                selectedFile = file;
                recordedBlob = null; // æ¸…é™¤å½•éŸ³ï¼Œä½¿ç”¨ä¸Šä¼ çš„æ–‡ä»¶
                audioSource = 'upload';
                showAudioPreview(URL.createObjectURL(file));
            }
        }

        function showAudioPreview(url) {
            const row = document.getElementById('audio-preview-row');
            const audio = document.getElementById('audio-preview');
            audio.src = url;
            row.classList.remove('hidden');
        }

        function clearAudio() {
            selectedFile = null;
            recordedBlob = null;
            document.getElementById('audio-preview-row').classList.add('hidden');
            document.getElementById('audio-preview').src = '';
            document.getElementById('ref-audio').value = '';
            if (mediaRecorder?.state === 'recording') mediaRecorder.stop();
            mediaRecorder = null;
            clearInterval(timerInterval);
        }

        async function generateCustom() {
            const text = document.getElementById('text-custom').value.trim();
            const speaker = document.getElementById('speaker').value;
            const language = document.getElementById('language-custom').value;
            const instruct = document.getElementById('instruct').value.trim();
            const btn = document.getElementById('btn-custom');
            const status = document.getElementById('status-custom');
            const container = document.getElementById('audio-container-custom');
            const audio = document.getElementById('audio-custom');

            if (!text) { status.textContent = 'è¯·è¾“å…¥è¦åˆæˆçš„æ–‡æœ¬'; status.classList.add('text-red-500'); return; }

            btn.disabled = true;
            status.textContent = '';
            container.classList.add('hidden');

            // ç¡®ä¿æ¨¡å‹å·²åŠ è½½
            const modelReady = await ensureModelLoaded('custom', status, btn);
            if (!modelReady) {
                btn.disabled = false;
                btn.textContent = 'ç”Ÿæˆè¯­éŸ³';
                return;
            }

            btn.innerHTML = '<span class="spinner"></span> ç”Ÿæˆä¸­...';
            status.textContent = '';

            try {
                const params = new URLSearchParams({ text, speaker, language });
                if (instruct) params.append('instruct', instruct);
                const response = await fetch(`/tts?${params.toString()}`);
                if (!response.ok) throw new Error('ç”Ÿæˆå¤±è´¥');

                audio.src = URL.createObjectURL(await response.blob());
                container.classList.remove('hidden');
                audio.play();
                status.textContent = 'ç”ŸæˆæˆåŠŸ';
                status.classList.remove('text-red-500');
            } catch (error) {
                status.textContent = 'ç”Ÿæˆå¤±è´¥: ' + error.message;
                status.classList.add('text-red-500');
            } finally {
                btn.disabled = false;
                btn.textContent = 'ç”Ÿæˆè¯­éŸ³';
            }
        }


        async function generateClone() {
            const text = document.getElementById('text-clone').value.trim();
            const language = document.getElementById('language-clone').value;
            const refText = document.getElementById('ref-text').value.trim();
            const btn = document.getElementById('btn-clone');
            const status = document.getElementById('status-clone');
            const container = document.getElementById('audio-container-clone');
            const audio = document.getElementById('audio-clone');

            if (!text) { status.textContent = 'è¯·è¾“å…¥è¦åˆæˆçš„æ–‡æœ¬'; status.classList.add('text-red-500'); return; }

            btn.disabled = true;
            status.textContent = '';
            container.classList.add('hidden');

            // ç¡®ä¿æ¨¡å‹å·²åŠ è½½
            const modelReady = await ensureModelLoaded('clone', status, btn);
            if (!modelReady) {
                btn.disabled = false;
                btn.textContent = 'å…‹éš†å¹¶ç”Ÿæˆè¯­éŸ³';
                return;
            }

            try {
                let response;
                if (selectedVoiceId) {
                    btn.innerHTML = '<span class="spinner"></span> ä½¿ç”¨å·²ä¿å­˜å£°éŸ³ç”Ÿæˆä¸­...';
                    const formData = new FormData();
                    formData.append('text', text);
                    formData.append('language', language);
                    response = await fetch(`/voices/${selectedVoiceId}/tts`, { method: 'POST', body: formData });
                } else {
                    let audioFile = null;
                    if (audioSource === 'record') {
                        if (!recordedBlob) { status.textContent = 'è¯·å…ˆå½•åˆ¶å‚è€ƒéŸ³é¢‘ï¼Œæˆ–ä»å£°éŸ³åº“é€‰æ‹©'; status.classList.add('text-red-500'); btn.disabled = false; btn.textContent = 'å…‹éš†å¹¶ç”Ÿæˆè¯­éŸ³'; return; }
                        audioFile = new File([recordedBlob], 'recording.webm', { type: 'audio/webm' });
                    } else {
                        if (!selectedFile) { status.textContent = 'è¯·å…ˆä¸Šä¼ å‚è€ƒéŸ³é¢‘ï¼Œæˆ–ä»å£°éŸ³åº“é€‰æ‹©'; status.classList.add('text-red-500'); btn.disabled = false; btn.textContent = 'å…‹éš†å¹¶ç”Ÿæˆè¯­éŸ³'; return; }
                        audioFile = selectedFile;
                    }
                    btn.innerHTML = '<span class="spinner"></span> å…‹éš†è¯­éŸ³ä¸­...';
                    const formData = new FormData();
                    formData.append('audio', audioFile);
                    formData.append('text', text);
                    formData.append('language', language);
                    formData.append('ref_text', refText);
                    response = await fetch('/clone', { method: 'POST', body: formData });
                }

                if (!response.ok) throw new Error((await response.json()).detail || 'ç”Ÿæˆå¤±è´¥');

                audio.src = URL.createObjectURL(await response.blob());
                container.classList.remove('hidden');
                audio.play();
                status.textContent = 'ç”ŸæˆæˆåŠŸ';
                status.classList.remove('text-red-500');
            } catch (error) {
                status.textContent = 'ç”Ÿæˆå¤±è´¥: ' + error.message;
                status.classList.add('text-red-500');
            } finally {
                btn.disabled = false;
                btn.textContent = 'å…‹éš†å¹¶ç”Ÿæˆè¯­éŸ³';
            }
        }

        function setCustomExample(text, speaker, language) {
            document.getElementById('text-custom').value = text;
            document.getElementById('speaker').value = speaker;
            document.getElementById('language-custom').value = language;
        }
    </script>
</body>
</html>
