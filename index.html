<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qwen3-TTS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        cream: '#F9F7F5',
                        'cream-dark': '#F0EDE8',
                        'warm-gray': '#E8E4DE',
                        charcoal: '#2D2D2D',
                        accent: '#D4A373',
                        'accent-dark': '#B8956A',
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .spinner {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid #D4A373;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes pulse-ring {
            0% { box-shadow: 0 0 0 0 rgba(212, 163, 115, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(212, 163, 115, 0); }
            100% { box-shadow: 0 0 0 0 rgba(212, 163, 115, 0); }
        }
        .recording { animation: pulse-ring 1.5s infinite; }
        audio { height: 40px; }
        audio::-webkit-media-controls-panel { background: #F9F7F5; }
    </style>
</head>
<body class="bg-cream min-h-screen">
    <div class="flex min-h-screen">
        <!-- å·¦ä¾§å¯¼èˆª -->
        <aside class="fixed left-0 top-0 bottom-0 w-48 bg-cream-dark/50 p-4 flex flex-col border-r border-warm-gray/50">
            <div class="mb-8">
                <h1 class="text-xl font-bold text-charcoal">Qwen3-TTS</h1>
                <p class="text-xs text-charcoal/50" data-i18n="subtitle">è¯­éŸ³åˆæˆæœåŠ¡</p>
            </div>

            <nav class="flex-1 space-y-2">
                <div onclick="switchPage('demo')" id="nav-demo"
                    class="px-4 py-3 rounded-xl cursor-pointer flex items-center gap-3 transition-all bg-white shadow-sm text-charcoal font-medium">
                    <span>ğŸ§</span> <span data-i18n="nav.demo">åœ¨çº¿è¯•ç”¨</span>
                </div>
                <div onclick="switchPage('api')" id="nav-api"
                    class="px-4 py-3 rounded-xl cursor-pointer flex items-center gap-3 transition-all text-charcoal/70 hover:bg-warm-gray/50">
                    <span>ğŸ“¡</span> <span data-i18n="nav.api">API æ–‡æ¡£</span>
                </div>
            </nav>

            <!-- è¯­è¨€åˆ‡æ¢ -->
            <div class="mb-4">
                <button onclick="toggleLanguage()" id="lang-btn"
                    class="w-full px-4 py-2 rounded-xl text-sm text-charcoal/70 hover:bg-warm-gray/50 flex items-center justify-center gap-2 transition-all">
                    ğŸŒ <span id="lang-label">ä¸­æ–‡ / EN</span>
                </button>
            </div>

            <div class="pt-4 border-t border-warm-gray/50 text-xs text-charcoal/40">
                Powered by Qwen3-TTS
            </div>
        </aside>

        <!-- ä¸»å†…å®¹åŒº -->
        <main class="flex-1 ml-48 p-6 pb-20">
            <!-- åœ¨çº¿è¯•ç”¨é¡µé¢ -->
            <div id="page-demo" class="max-w-3xl mx-auto">
                <!-- ä¸»æ ‡ç­¾åˆ‡æ¢ -->
        <div class="flex gap-3 mb-6">
            <button onclick="switchTab('custom')" id="tab-custom"
                class="flex-1 px-6 py-3 rounded-xl font-medium transition-all bg-accent text-white">
                ğŸ™ï¸ <span data-i18n="tab.preset">é¢„è®¾è¯´è¯äºº</span>
            </button>
            <button onclick="switchTab('design')" id="tab-design"
                class="flex-1 px-6 py-3 rounded-xl font-medium transition-all bg-warm-gray text-charcoal/70 hover:bg-accent/20">
                ğŸ¨ <span data-i18n="tab.design">å£°éŸ³è®¾è®¡</span>
            </button>
            <button onclick="switchTab('clone')" id="tab-clone"
                class="flex-1 px-6 py-3 rounded-xl font-medium transition-all bg-warm-gray text-charcoal/70 hover:bg-accent/20">
                ğŸ­ <span data-i18n="tab.clone">è¯­éŸ³å…‹éš†</span>
            </button>
        </div>

        <!-- é¢„è®¾è¯´è¯äººé¢æ¿ -->
        <div id="panel-custom" class="space-y-5">
            <!-- æ–‡æœ¬è¾“å…¥ -->
            <div class="bg-white rounded-2xl p-5 shadow-sm border border-warm-gray/50">
                <h3 class="text-lg font-semibold text-charcoal mb-4 flex items-center gap-2">
                    <span class="w-8 h-8 bg-accent/10 rounded-lg flex items-center justify-center">ğŸ“</span>
                    <span data-i18n="input.title">è¾“å…¥æ–‡æœ¬</span>
                </h3>
                <textarea id="text-custom" rows="3"
                    class="w-full px-4 py-3 bg-white border border-warm-gray rounded-xl text-charcoal placeholder-charcoal/40 focus:outline-none focus:border-accent focus:ring-2 focus:ring-accent/20 transition-all resize-none"
                    data-i18n-placeholder="input.placeholder">ä½ å¥½ï¼Œæˆ‘æ˜¯é€šä¹‰åƒé—®è¯­éŸ³åˆæˆæ¨¡å‹ï¼Œå¾ˆé«˜å…´è®¤è¯†ä½ ï¼</textarea>
            </div>

            <!-- è¯­éŸ³è®¾ç½® -->
            <div class="bg-white rounded-2xl p-5 shadow-sm border border-warm-gray/50">
                <h3 class="text-lg font-semibold text-charcoal mb-4 flex items-center gap-2">
                    <span class="w-8 h-8 bg-accent/10 rounded-lg flex items-center justify-center">âš™ï¸</span>
                    <span data-i18n="settings.title">è¯­éŸ³è®¾ç½®</span>
                </h3>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-charcoal/70 mb-2" data-i18n="settings.speaker">è¯´è¯äºº</label>
                        <select id="speaker"
                            class="w-full px-4 py-3 bg-white border border-warm-gray rounded-xl text-charcoal focus:outline-none focus:border-accent transition-all">
                            <option value="vivian">Vivian (å¥³å£°-ä¸­æ–‡)</option>
                            <option value="uncle_fu">Uncle Fu (ç”·å£°-ä¸­æ–‡)</option>
                            <option value="aiden">Aiden (ç”·å£°-è‹±æ–‡)</option>
                            <option value="serena">Serena (å¥³å£°-è‹±æ–‡)</option>
                            <option value="ono_anna">Ono Anna (å¥³å£°-æ—¥æ–‡)</option>
                            <option value="sohee">Sohee (å¥³å£°-éŸ©æ–‡)</option>
                            <option value="dylan">Dylan (ç”·å£°)</option>
                            <option value="eric">Eric (ç”·å£°)</option>
                            <option value="ryan">Ryan (ç”·å£°)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-charcoal/70 mb-2" data-i18n="settings.language">è¯­è¨€</label>
                        <select id="language-custom"
                            class="w-full px-4 py-3 bg-white border border-warm-gray rounded-xl text-charcoal focus:outline-none focus:border-accent transition-all">
                            <option value="Chinese">ä¸­æ–‡</option>
                            <option value="English">English</option>
                            <option value="Japanese">æ—¥æœ¬èª</option>
                            <option value="Korean">í•œêµ­ì–´</option>
                            <option value="German">Deutsch</option>
                            <option value="French">FranÃ§ais</option>
                            <option value="Spanish">EspaÃ±ol</option>
                            <option value="Russian">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                            <option value="Portuguese">PortuguÃªs</option>
                            <option value="Italian">Italiano</option>
                        </select>
                    </div>
                </div>
                <div class="mt-4">
                    <label class="block text-sm font-medium text-charcoal/70 mb-2" data-i18n="settings.instruct">æƒ…æ„ŸæŒ‡ä»¤ï¼ˆå¯é€‰ï¼‰</label>
                    <input type="text" id="instruct"
                        class="w-full px-4 py-3 bg-white border border-warm-gray rounded-xl text-charcoal placeholder-charcoal/40 focus:outline-none focus:border-accent focus:ring-2 focus:ring-accent/20 transition-all"
                        data-i18n-placeholder="settings.instructPlaceholder">
                </div>
            </div>

            <!-- ç”ŸæˆæŒ‰é’® -->
            <div class="flex gap-3">
                <button onclick="generateCustom()" id="btn-custom"
                    class="flex-1 py-4 bg-accent hover:bg-accent-dark text-white font-semibold rounded-xl transition-all shadow-sm hover:shadow-md"
                    data-i18n="btn.generate">
                    ç”Ÿæˆè¯­éŸ³
                </button>
            </div>

            <!-- çŠ¶æ€å’Œç»“æœ -->
            <div id="status-custom" class="text-center text-sm text-charcoal/60"></div>
            <div id="audio-container-custom" class="hidden bg-white rounded-2xl p-5 shadow-sm border border-warm-gray/50">
                <h3 class="text-lg font-semibold text-charcoal mb-3 flex items-center gap-2">
                    <span class="w-8 h-8 bg-accent/10 rounded-lg flex items-center justify-center">ğŸ”Š</span>
                    <span data-i18n="result.title">ç”Ÿæˆç»“æœ</span>
                </h3>
                <audio id="audio-custom" controls class="w-full"></audio>
            </div>

            <!-- ç¤ºä¾‹ -->
            <div class="flex gap-2 flex-wrap">
                <span class="text-sm text-charcoal/50" data-i18n="examples.title">å¿«é€Ÿç¤ºä¾‹ï¼š</span>
                <button onclick="setCustomExample('ä½ å¥½ï¼Œæ¬¢è¿ä½¿ç”¨é€šä¹‰åƒé—®è¯­éŸ³åˆæˆç³»ç»Ÿï¼', 'vivian', 'Chinese')"
                    class="px-3 py-1 bg-cream-dark rounded-lg text-sm text-charcoal/70 hover:bg-warm-gray transition-all" data-i18n="examples.chinese">ä¸­æ–‡é—®å€™</button>
                <button onclick="setCustomExample('Hello! Welcome to Qwen Text-to-Speech!', 'aiden', 'English')"
                    class="px-3 py-1 bg-cream-dark rounded-lg text-sm text-charcoal/70 hover:bg-warm-gray transition-all" data-i18n="examples.english">è‹±æ–‡é—®å€™</button>
                <button onclick="setCustomExample('ã“ã‚“ã«ã¡ã¯ã€ç§ã¯Qwenã§ã™ã€‚', 'ono_anna', 'Japanese')"
                    class="px-3 py-1 bg-cream-dark rounded-lg text-sm text-charcoal/70 hover:bg-warm-gray transition-all" data-i18n="examples.japanese">æ—¥æ–‡é—®å€™</button>
            </div>
        </div>

        <!-- å£°éŸ³è®¾è®¡é¢æ¿ -->
        <div id="panel-design" class="hidden space-y-5">
            <!-- å£°éŸ³æè¿° -->
            <div class="bg-white rounded-2xl p-5 shadow-sm border border-warm-gray/50">
                <h3 class="text-lg font-semibold text-charcoal mb-4 flex items-center gap-2">
                    <span class="w-8 h-8 bg-accent/10 rounded-lg flex items-center justify-center">ğŸ¨</span>
                    <span data-i18n="design.descTitle">å£°éŸ³æè¿°</span>
                </h3>
                <textarea id="instruct-design" rows="3"
                    class="w-full px-4 py-3 bg-white border border-warm-gray rounded-xl text-charcoal placeholder-charcoal/40 focus:outline-none focus:border-accent focus:ring-2 focus:ring-accent/20 transition-all resize-none"
                    data-i18n-placeholder="design.descPlaceholder"></textarea>
                <div class="flex gap-2 flex-wrap mt-3">
                    <span class="text-xs text-charcoal/50" data-i18n="design.quickSelect">å¿«é€Ÿé€‰æ‹©ï¼š</span>
                    <button onclick="setDesignExample('ä½æ²‰æ²™å“‘çš„ä¸­å¹´ç”·å£°ï¼Œè¯­é€Ÿåæ…¢')"
                        class="px-2 py-1 bg-cream-dark rounded text-xs text-charcoal/70 hover:bg-warm-gray transition-all" data-i18n="design.matureMale">æˆç†Ÿç”·å£°</button>
                    <button onclick="setDesignExample('æ¸©æŸ”ç”œç¾çš„å°‘å¥³å£°ï¼ŒéŸ³è°ƒåé«˜ï¼Œè¯­æ°”æ´»æ³¼')"
                        class="px-2 py-1 bg-cream-dark rounded text-xs text-charcoal/70 hover:bg-warm-gray transition-all" data-i18n="design.sweetGirl">ç”œç¾å°‘å¥³</button>
                    <button onclick="setDesignExample('ä½“ç°æ’’å¨‡ç¨šå«©çš„èè‰å¥³å£°ï¼ŒéŸ³è°ƒåé«˜ä¸”èµ·ä¼æ˜æ˜¾')"
                        class="px-2 py-1 bg-cream-dark rounded text-xs text-charcoal/70 hover:bg-warm-gray transition-all" data-i18n="design.loli">èè‰éŸ³</button>
                    <button onclick="setDesignExample('A deep, authoritative male voice with clear pronunciation')"
                        class="px-2 py-1 bg-cream-dark rounded text-xs text-charcoal/70 hover:bg-warm-gray transition-all" data-i18n="design.authoritative">æƒå¨ç”·å£°</button>
                    <button onclick="setDesignExample('A cheerful young female voice with a warm, friendly tone')"
                        class="px-2 py-1 bg-cream-dark rounded text-xs text-charcoal/70 hover:bg-warm-gray transition-all" data-i18n="design.cheerful">æ´»æ³¼å¥³å£°</button>
                </div>
            </div>

            <!-- åˆæˆè®¾ç½® -->
            <div class="bg-white rounded-2xl p-5 shadow-sm border border-warm-gray/50">
                <h3 class="text-lg font-semibold text-charcoal mb-4 flex items-center gap-2">
                    <span class="w-8 h-8 bg-accent/10 rounded-lg flex items-center justify-center">ğŸ“</span>
                    <span data-i18n="design.synthTitle">åˆæˆè®¾ç½®</span>
                </h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-charcoal/70 mb-2" data-i18n="design.textLabel">è¦åˆæˆçš„æ–‡æœ¬</label>
                        <textarea id="text-design" rows="2"
                            class="w-full px-4 py-3 bg-white border border-warm-gray rounded-xl text-charcoal placeholder-charcoal/40 focus:outline-none focus:border-accent focus:ring-2 focus:ring-accent/20 transition-all resize-none"
                            data-i18n-placeholder="input.placeholder">ä½ å¥½ï¼Œæˆ‘æ˜¯æ ¹æ®ä½ çš„æè¿°ç”Ÿæˆçš„å£°éŸ³ã€‚</textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-charcoal/70 mb-2" data-i18n="settings.language">è¯­è¨€</label>
                        <select id="language-design"
                            class="w-full px-4 py-3 bg-white border border-warm-gray rounded-xl text-charcoal focus:outline-none focus:border-accent transition-all">
                            <option value="Chinese">ä¸­æ–‡</option>
                            <option value="English">English</option>
                            <option value="Japanese">æ—¥æœ¬èª</option>
                            <option value="Korean">í•œêµ­ì–´</option>
                            <option value="German">Deutsch</option>
                            <option value="French">FranÃ§ais</option>
                            <option value="Spanish">EspaÃ±ol</option>
                            <option value="Russian">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                            <option value="Portuguese">PortuguÃªs</option>
                            <option value="Italian">Italiano</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- ç”ŸæˆæŒ‰é’® -->
            <button onclick="generateDesign()" id="btn-design"
                class="w-full py-4 bg-accent hover:bg-accent-dark text-white font-semibold rounded-xl transition-all shadow-sm hover:shadow-md"
                data-i18n="btn.generateVoice">
                ç”Ÿæˆå£°éŸ³
            </button>

            <!-- çŠ¶æ€å’Œç»“æœ -->
            <div id="status-design" class="text-center text-sm text-charcoal/60"></div>
            <div id="audio-container-design" class="hidden bg-white rounded-2xl p-5 shadow-sm border border-warm-gray/50">
                <h3 class="text-lg font-semibold text-charcoal mb-3 flex items-center gap-2">
                    <span class="w-8 h-8 bg-accent/10 rounded-lg flex items-center justify-center">ğŸ”Š</span>
                    <span data-i18n="result.title">ç”Ÿæˆç»“æœ</span>
                </h3>
                <audio id="audio-design" controls class="w-full"></audio>
            </div>
        </div>

        <!-- è¯­éŸ³å…‹éš†é¢æ¿ -->
        <div id="panel-clone" class="hidden space-y-5">
            <!-- å£°éŸ³åº“ -->
            <div class="bg-white rounded-2xl p-5 shadow-sm border border-warm-gray/50">
                <h3 class="text-lg font-semibold text-charcoal mb-4 flex items-center gap-2">
                    <span class="w-8 h-8 bg-accent/10 rounded-lg flex items-center justify-center">ğŸ’¾</span>
                    <span data-i18n="clone.library">æˆ‘çš„å£°éŸ³åº“</span>
                </h3>
                <div id="voice-list" class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                    <div id="no-voices" class="col-span-full text-center py-6 text-charcoal/40 text-sm" data-i18n="clone.noVoices">
                        æš‚æ— ä¿å­˜çš„å£°éŸ³
                    </div>
                </div>
            </div>

            <!-- æ–°å»ºå…‹éš† -->
            <div class="bg-white rounded-2xl p-5 shadow-sm border border-warm-gray/50">
                <h3 class="text-lg font-semibold text-charcoal mb-4 flex items-center gap-2">
                    <span class="w-8 h-8 bg-accent/10 rounded-lg flex items-center justify-center">ğŸ¤</span>
                    <span data-i18n="clone.refAudio">å‚è€ƒéŸ³é¢‘</span>
                </h3>

                <!-- æ“ä½œæŒ‰é’® -->
                <div class="flex gap-3 mb-4">
                    <button onclick="toggleRecording()" id="record-btn"
                        class="flex-1 px-4 py-3 rounded-xl font-medium transition-all bg-red-500 hover:bg-red-600 text-white flex items-center justify-center gap-2">
                        <span id="record-icon">ğŸ™ï¸</span>
                        <span id="record-text" data-i18n="clone.record">å½•éŸ³</span>
                    </button>
                    <button onclick="document.getElementById('ref-audio').click()"
                        class="flex-1 px-4 py-3 rounded-xl font-medium transition-all bg-warm-gray hover:bg-charcoal/10 text-charcoal/70 flex items-center justify-center gap-2">
                        ğŸ“ <span data-i18n="clone.upload">ä¸Šä¼ æ–‡ä»¶</span>
                    </button>
                    <input type="file" id="ref-audio" accept="audio/*" onchange="handleFileSelect(this)" class="hidden">
                </div>

                <!-- å½•éŸ³è®¡æ—¶å™¨ -->
                <div id="record-timer-row" class="hidden flex items-center gap-3 mb-4 p-3 bg-red-50 rounded-xl">
                    <div class="w-3 h-3 bg-red-500 rounded-full animate-pulse"></div>
                    <span class="text-red-600 font-medium" data-i18n="clone.recording">æ­£åœ¨å½•éŸ³</span>
                    <span id="record-timer" class="text-red-500 font-bold">00:00</span>
                </div>

                <!-- éŸ³é¢‘é¢„è§ˆ -->
                <div id="audio-preview-row" class="hidden flex items-center gap-3 p-3 bg-cream-dark rounded-xl">
                    <audio id="audio-preview" controls class="flex-1 h-10"></audio>
                    <button onclick="clearAudio()" class="px-3 py-1.5 text-charcoal/50 hover:text-red-500 text-sm transition-all" data-i18n="clone.clear">æ¸…é™¤</button>
                </div>

                <!-- å‚è€ƒæ–‡æœ¬ -->
                <div class="mt-4">
                    <label class="block text-sm font-medium text-charcoal/70 mb-2" data-i18n="clone.refTextLabel">å‚è€ƒéŸ³é¢‘æ–‡å­—å†…å®¹ï¼ˆå¯é€‰ï¼Œå¯æé«˜è´¨é‡ï¼‰</label>
                    <input type="text" id="ref-text"
                        class="w-full px-4 py-3 bg-white border border-warm-gray rounded-xl text-charcoal placeholder-charcoal/40 focus:outline-none focus:border-accent focus:ring-2 focus:ring-accent/20 transition-all"
                        data-i18n-placeholder="clone.refTextPlaceholder">
                </div>
            </div>

            <!-- åˆæˆè®¾ç½® -->
            <div class="bg-white rounded-2xl p-5 shadow-sm border border-warm-gray/50">
                <h3 class="text-lg font-semibold text-charcoal mb-4 flex items-center gap-2">
                    <span class="w-8 h-8 bg-accent/10 rounded-lg flex items-center justify-center">ğŸ“</span>
                    <span data-i18n="design.synthTitle">åˆæˆè®¾ç½®</span>
                </h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-charcoal/70 mb-2" data-i18n="design.textLabel">è¦åˆæˆçš„æ–‡æœ¬</label>
                        <textarea id="text-clone" rows="2"
                            class="w-full px-4 py-3 bg-white border border-warm-gray rounded-xl text-charcoal placeholder-charcoal/40 focus:outline-none focus:border-accent focus:ring-2 focus:ring-accent/20 transition-all resize-none"
                            data-i18n-placeholder="clone.synthPlaceholder">ä½ å¥½ï¼Œè¿™æ˜¯ä½¿ç”¨è¯­éŸ³å…‹éš†æŠ€æœ¯ç”Ÿæˆçš„è¯­éŸ³ã€‚</textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-charcoal/70 mb-2" data-i18n="settings.language">è¯­è¨€</label>
                        <select id="language-clone"
                            class="w-full px-4 py-3 bg-white border border-warm-gray rounded-xl text-charcoal focus:outline-none focus:border-accent transition-all">
                            <option value="Chinese">ä¸­æ–‡</option>
                            <option value="English">English</option>
                            <option value="Japanese">æ—¥æœ¬èª</option>
                            <option value="Korean">í•œêµ­ì–´</option>
                            <option value="German">Deutsch</option>
                            <option value="French">FranÃ§ais</option>
                            <option value="Spanish">EspaÃ±ol</option>
                            <option value="Russian">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                            <option value="Portuguese">PortuguÃªs</option>
                            <option value="Italian">Italiano</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- ç”ŸæˆæŒ‰é’® -->
            <button onclick="generateClone()" id="btn-clone"
                class="w-full py-4 bg-accent hover:bg-accent-dark text-white font-semibold rounded-xl transition-all shadow-sm hover:shadow-md"
                data-i18n="btn.cloneGenerate">
                å…‹éš†å¹¶ç”Ÿæˆè¯­éŸ³
            </button>

            <!-- çŠ¶æ€å’Œç»“æœ -->
            <div id="status-clone" class="text-center text-sm text-charcoal/60"></div>
            <div id="audio-container-clone" class="hidden bg-white rounded-2xl p-5 shadow-sm border border-warm-gray/50">
                <h3 class="text-lg font-semibold text-charcoal mb-3 flex items-center gap-2">
                    <span class="w-8 h-8 bg-accent/10 rounded-lg flex items-center justify-center">ğŸ”Š</span>
                    <span data-i18n="result.title">ç”Ÿæˆç»“æœ</span>
                </h3>
                <audio id="audio-clone" controls class="w-full"></audio>
                <div class="flex gap-2 mt-4">
                    <input type="text" id="voice-name"
                        class="flex-1 px-4 py-2 bg-white border border-warm-gray rounded-xl text-charcoal placeholder-charcoal/40 focus:outline-none focus:border-accent transition-all text-sm"
                        data-i18n-placeholder="clone.saveNamePlaceholder">
                    <button onclick="saveVoice()" class="px-4 py-2 bg-warm-gray text-charcoal/70 rounded-xl text-sm font-medium hover:bg-charcoal/10 transition-all" data-i18n="btn.save">
                        ä¿å­˜
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- API æ–‡æ¡£é¡µé¢ -->
    <div id="page-api" class="hidden max-w-3xl mx-auto space-y-6">
                <div class="bg-white rounded-2xl p-6 shadow-sm border border-warm-gray/50">
                    <h2 class="text-2xl font-bold text-charcoal mb-2" data-i18n="api.title">API æ–‡æ¡£</h2>
                    <p class="text-charcoal/60" data-i18n="api.subtitle">é€šè¿‡ HTTP API é›†æˆè¯­éŸ³åˆæˆèƒ½åŠ›åˆ°ä½ çš„åº”ç”¨ä¸­</p>
                </div>

                <!-- é¢„è®¾è¯´è¯äºº API -->
                <div class="bg-white rounded-2xl p-5 shadow-sm border border-warm-gray/50">
                    <h3 class="text-lg font-semibold text-charcoal mb-4 flex items-center gap-2">
                        <span class="w-8 h-8 bg-accent/10 rounded-lg flex items-center justify-center">ğŸ™ï¸</span>
                        <span data-i18n="api.presetTTS">é¢„è®¾è¯´è¯äºº TTS</span>
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <div class="flex items-center gap-2 mb-2">
                                <span class="px-2 py-1 bg-green-100 text-green-700 text-xs font-medium rounded">GET</span>
                                <code class="text-sm text-charcoal">/tts</code>
                            </div>
                            <div class="bg-charcoal rounded-xl p-4 overflow-x-auto">
                                <pre class="text-sm text-green-400"><code>curl "http://localhost:8000/tts?text=ä½ å¥½ä¸–ç•Œ&speaker=vivian&language=Chinese" --output audio.wav</code></pre>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <p class="font-medium text-charcoal mb-1" data-i18n="api.params">å‚æ•°</p>
                                <ul class="text-charcoal/70 space-y-1">
                                    <li><code class="bg-cream-dark px-1 rounded">text</code> - <span data-i18n="api.paramText">è¦åˆæˆçš„æ–‡æœ¬</span></li>
                                    <li><code class="bg-cream-dark px-1 rounded">speaker</code> - <span data-i18n="api.paramSpeaker">è¯´è¯äºº</span></li>
                                    <li><code class="bg-cream-dark px-1 rounded">language</code> - <span data-i18n="api.paramLang">è¯­è¨€</span></li>
                                    <li><code class="bg-cream-dark px-1 rounded">instruct</code> - <span data-i18n="api.paramInstruct">æƒ…æ„ŸæŒ‡ä»¤ï¼ˆå¯é€‰ï¼‰</span></li>
                                </ul>
                            </div>
                            <div>
                                <p class="font-medium text-charcoal mb-1" data-i18n="api.speakerList">è¯´è¯äººåˆ—è¡¨</p>
                                <p class="text-charcoal/70">vivian, uncle_fu, aiden, serena, ono_anna, sohee, dylan, eric, ryan</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- è¯­éŸ³å…‹éš† API -->
                <div class="bg-white rounded-2xl p-5 shadow-sm border border-warm-gray/50">
                    <h3 class="text-lg font-semibold text-charcoal mb-4 flex items-center gap-2">
                        <span class="w-8 h-8 bg-accent/10 rounded-lg flex items-center justify-center">ğŸ­</span>
                        <span data-i18n="api.voiceClone">è¯­éŸ³å…‹éš†</span>
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <div class="flex items-center gap-2 mb-2">
                                <span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded">POST</span>
                                <code class="text-sm text-charcoal">/clone</code>
                            </div>
                            <div class="bg-charcoal rounded-xl p-4 overflow-x-auto">
                                <pre class="text-sm text-green-400"><code>curl -X POST "http://localhost:8000/clone" \
  -F "audio=@reference.wav" \
  -F "text=è¦åˆæˆçš„æ–‡æœ¬" \
  -F "language=Chinese" \
  -F "ref_text=å‚è€ƒéŸ³é¢‘å†…å®¹" \
  --output clone.wav</code></pre>
                            </div>
                        </div>
                        <div class="text-sm">
                            <p class="font-medium text-charcoal mb-1" data-i18n="api.params">å‚æ•°</p>
                            <ul class="text-charcoal/70 space-y-1">
                                <li><code class="bg-cream-dark px-1 rounded">audio</code> - <span data-i18n="api.paramAudio">å‚è€ƒéŸ³é¢‘æ–‡ä»¶ï¼ˆ3-10ç§’ï¼‰</span></li>
                                <li><code class="bg-cream-dark px-1 rounded">text</code> - <span data-i18n="api.paramText">è¦åˆæˆçš„æ–‡æœ¬</span></li>
                                <li><code class="bg-cream-dark px-1 rounded">language</code> - <span data-i18n="api.paramLang">è¯­è¨€</span></li>
                                <li><code class="bg-cream-dark px-1 rounded">ref_text</code> - <span data-i18n="api.paramRefText">å‚è€ƒéŸ³é¢‘æ–‡å­—å†…å®¹ï¼ˆå¯é€‰ï¼Œæä¾›å¯æé«˜è´¨é‡ï¼‰</span></li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- å£°éŸ³åº“ API -->
                <div class="bg-white rounded-2xl p-5 shadow-sm border border-warm-gray/50">
                    <h3 class="text-lg font-semibold text-charcoal mb-4 flex items-center gap-2">
                        <span class="w-8 h-8 bg-accent/10 rounded-lg flex items-center justify-center">ğŸ’¾</span>
                        <span data-i18n="api.voiceLibrary">å£°éŸ³åº“ç®¡ç†</span>
                    </h3>
                    <div class="space-y-4 text-sm">
                        <div class="flex items-center gap-3 p-3 bg-cream-dark rounded-xl">
                            <span class="px-2 py-1 bg-green-100 text-green-700 text-xs font-medium rounded">GET</span>
                            <code class="text-charcoal">/voices</code>
                            <span class="text-charcoal/50" data-i18n="api.getVoices">è·å–å·²ä¿å­˜çš„å£°éŸ³åˆ—è¡¨</span>
                        </div>
                        <div class="flex items-center gap-3 p-3 bg-cream-dark rounded-xl">
                            <span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded">POST</span>
                            <code class="text-charcoal">/voices/save</code>
                            <span class="text-charcoal/50" data-i18n="api.saveVoice">ä¿å­˜å£°éŸ³åˆ°å£°éŸ³åº“</span>
                        </div>
                        <div class="flex items-center gap-3 p-3 bg-cream-dark rounded-xl">
                            <span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded">POST</span>
                            <code class="text-charcoal">/voices/{'{voice_id}'}/tts</code>
                            <span class="text-charcoal/50" data-i18n="api.useSavedVoice">ä½¿ç”¨å·²ä¿å­˜å£°éŸ³ç”Ÿæˆè¯­éŸ³</span>
                        </div>
                        <div class="flex items-center gap-3 p-3 bg-cream-dark rounded-xl">
                            <span class="px-2 py-1 bg-red-100 text-red-700 text-xs font-medium rounded">DELETE</span>
                            <code class="text-charcoal">/voices/{'{voice_id}'}</code>
                            <span class="text-charcoal/50" data-i18n="api.deleteVoice">åˆ é™¤å·²ä¿å­˜çš„å£°éŸ³</span>
                        </div>
                    </div>
                </div>

                <!-- å…¶ä»–æ¥å£ -->
                <div class="bg-white rounded-2xl p-5 shadow-sm border border-warm-gray/50">
                    <h3 class="text-lg font-semibold text-charcoal mb-4 flex items-center gap-2">
                        <span class="w-8 h-8 bg-accent/10 rounded-lg flex items-center justify-center">ğŸ“‹</span>
                        <span data-i18n="api.otherEndpoints">å…¶ä»–æ¥å£</span>
                    </h3>
                    <div class="space-y-3 text-sm">
                        <div class="flex items-center gap-3 p-3 bg-cream-dark rounded-xl">
                            <span class="px-2 py-1 bg-green-100 text-green-700 text-xs font-medium rounded">GET</span>
                            <code class="text-charcoal">/speakers</code>
                            <span class="text-charcoal/50" data-i18n="api.getSpeakers">è·å–å¯ç”¨è¯´è¯äººåˆ—è¡¨</span>
                        </div>
                        <div class="flex items-center gap-3 p-3 bg-cream-dark rounded-xl">
                            <span class="px-2 py-1 bg-green-100 text-green-700 text-xs font-medium rounded">GET</span>
                            <code class="text-charcoal">/languages</code>
                            <span class="text-charcoal/50" data-i18n="api.getLanguages">è·å–æ”¯æŒçš„è¯­è¨€åˆ—è¡¨</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- éšè—çš„é¢„è§ˆéŸ³é¢‘ -->
    <audio id="voice-preview-audio" class="hidden"></audio>

    <script>
        // ==================== i18n å›½é™…åŒ– ====================
        const i18n = {
            zh: {
                subtitle: 'è¯­éŸ³åˆæˆæœåŠ¡',
                'nav.demo': 'åœ¨çº¿è¯•ç”¨',
                'nav.api': 'API æ–‡æ¡£',
                'tab.preset': 'é¢„è®¾è¯´è¯äºº',
                'tab.design': 'å£°éŸ³è®¾è®¡',
                'tab.clone': 'è¯­éŸ³å…‹éš†',
                'input.title': 'è¾“å…¥æ–‡æœ¬',
                'input.placeholder': 'è¯·è¾“å…¥è¦åˆæˆçš„æ–‡æœ¬...',
                'settings.title': 'è¯­éŸ³è®¾ç½®',
                'settings.speaker': 'è¯´è¯äºº',
                'settings.language': 'è¯­è¨€',
                'settings.instruct': 'æƒ…æ„ŸæŒ‡ä»¤ï¼ˆå¯é€‰ï¼‰',
                'settings.instructPlaceholder': 'ä¾‹å¦‚ï¼šç”¨å¼€å¿ƒçš„è¯­æ°”è¯´ã€ç”¨æ‚²ä¼¤çš„è¯­æ°”è¯´',
                'btn.generate': 'ç”Ÿæˆè¯­éŸ³',
                'btn.generateVoice': 'ç”Ÿæˆå£°éŸ³',
                'btn.cloneGenerate': 'å…‹éš†å¹¶ç”Ÿæˆè¯­éŸ³',
                'btn.save': 'ä¿å­˜',
                'result.title': 'ç”Ÿæˆç»“æœ',
                'examples.title': 'å¿«é€Ÿç¤ºä¾‹ï¼š',
                'examples.chinese': 'ä¸­æ–‡é—®å€™',
                'examples.english': 'è‹±æ–‡é—®å€™',
                'examples.japanese': 'æ—¥æ–‡é—®å€™',
                'design.descTitle': 'å£°éŸ³æè¿°',
                'design.descPlaceholder': 'ç”¨è‡ªç„¶è¯­è¨€æè¿°ä½ æƒ³è¦çš„å£°éŸ³ï¼Œä¾‹å¦‚ï¼šä½æ²‰æ²™å“‘çš„ä¸­å¹´ç”·å£°ã€æ¸©æŸ”ç”œç¾çš„å°‘å¥³å£°...',
                'design.quickSelect': 'å¿«é€Ÿé€‰æ‹©ï¼š',
                'design.matureMale': 'æˆç†Ÿç”·å£°',
                'design.sweetGirl': 'ç”œç¾å°‘å¥³',
                'design.loli': 'èè‰éŸ³',
                'design.authoritative': 'æƒå¨ç”·å£°',
                'design.cheerful': 'æ´»æ³¼å¥³å£°',
                'design.synthTitle': 'åˆæˆè®¾ç½®',
                'design.textLabel': 'è¦åˆæˆçš„æ–‡æœ¬',
                'clone.library': 'æˆ‘çš„å£°éŸ³åº“',
                'clone.noVoices': 'æš‚æ— ä¿å­˜çš„å£°éŸ³',
                'clone.refAudio': 'å‚è€ƒéŸ³é¢‘',
                'clone.record': 'å½•éŸ³',
                'clone.stop': 'åœæ­¢',
                'clone.upload': 'ä¸Šä¼ æ–‡ä»¶',
                'clone.recording': 'æ­£åœ¨å½•éŸ³',
                'clone.clear': 'æ¸…é™¤',
                'clone.refTextLabel': 'å‚è€ƒéŸ³é¢‘æ–‡å­—å†…å®¹ï¼ˆå¯é€‰ï¼Œå¯æé«˜è´¨é‡ï¼‰',
                'clone.refTextPlaceholder': 'è¾“å…¥å‚è€ƒéŸ³é¢‘ä¸­è¯´çš„è¯...',
                'clone.synthPlaceholder': 'è¯·è¾“å…¥è¦ç”¨å…‹éš†å£°éŸ³æœ—è¯»çš„æ–‡æœ¬...',
                'clone.saveNamePlaceholder': 'è¾“å…¥åç§°ä¿å­˜åˆ°å£°éŸ³åº“',
                'api.title': 'API æ–‡æ¡£',
                'api.subtitle': 'é€šè¿‡ HTTP API é›†æˆè¯­éŸ³åˆæˆèƒ½åŠ›åˆ°ä½ çš„åº”ç”¨ä¸­',
                'api.presetTTS': 'é¢„è®¾è¯´è¯äºº TTS',
                'api.voiceClone': 'è¯­éŸ³å…‹éš†',
                'api.voiceLibrary': 'å£°éŸ³åº“ç®¡ç†',
                'api.otherEndpoints': 'å…¶ä»–æ¥å£',
                'api.params': 'å‚æ•°',
                'api.paramText': 'è¦åˆæˆçš„æ–‡æœ¬',
                'api.paramSpeaker': 'è¯´è¯äºº',
                'api.paramLang': 'è¯­è¨€',
                'api.paramInstruct': 'æƒ…æ„ŸæŒ‡ä»¤ï¼ˆå¯é€‰ï¼‰',
                'api.paramAudio': 'å‚è€ƒéŸ³é¢‘æ–‡ä»¶ï¼ˆ3-10ç§’ï¼‰',
                'api.paramRefText': 'å‚è€ƒéŸ³é¢‘æ–‡å­—å†…å®¹ï¼ˆå¯é€‰ï¼Œæä¾›å¯æé«˜è´¨é‡ï¼‰',
                'api.speakerList': 'è¯´è¯äººåˆ—è¡¨',
                'api.getVoices': 'è·å–å·²ä¿å­˜çš„å£°éŸ³åˆ—è¡¨',
                'api.saveVoice': 'ä¿å­˜å£°éŸ³åˆ°å£°éŸ³åº“',
                'api.useSavedVoice': 'ä½¿ç”¨å·²ä¿å­˜å£°éŸ³ç”Ÿæˆè¯­éŸ³',
                'api.deleteVoice': 'åˆ é™¤å·²ä¿å­˜çš„å£°éŸ³',
                'api.getSpeakers': 'è·å–å¯ç”¨è¯´è¯äººåˆ—è¡¨',
                'api.getLanguages': 'è·å–æ”¯æŒçš„è¯­è¨€åˆ—è¡¨',
                'status.loadingModel': 'æ­£åœ¨åŠ è½½æ¨¡å‹ï¼Œè¯·ç¨å€™...',
                'status.loadingModelTime': 'æ­£åœ¨åŠ è½½æ¨¡å‹... ({0}ç§’)',
                'status.modelLoaded': 'æ¨¡å‹åŠ è½½å®Œæˆ',
                'status.modelLoadFailed': 'æ¨¡å‹åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•',
                'status.modelLoadTimeout': 'æ¨¡å‹åŠ è½½è¶…æ—¶ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•',
                'status.generating': 'ç”Ÿæˆä¸­...',
                'status.loadingModelBtn': 'åŠ è½½æ¨¡å‹ä¸­...',
                'status.success': 'ç”ŸæˆæˆåŠŸ',
                'status.failed': 'ç”Ÿæˆå¤±è´¥',
                'status.enterText': 'è¯·è¾“å…¥è¦åˆæˆçš„æ–‡æœ¬',
                'status.enterDesc': 'è¯·è¾“å…¥å£°éŸ³æè¿°',
                'status.needAudio': 'è¯·å…ˆå½•åˆ¶å‚è€ƒéŸ³é¢‘ï¼Œæˆ–ä»å£°éŸ³åº“é€‰æ‹©',
                'status.needUpload': 'è¯·å…ˆä¸Šä¼ å‚è€ƒéŸ³é¢‘ï¼Œæˆ–ä»å£°éŸ³åº“é€‰æ‹©',
                'status.usingSaved': 'ä½¿ç”¨å·²ä¿å­˜å£°éŸ³ç”Ÿæˆä¸­...',
                'status.cloning': 'å…‹éš†è¯­éŸ³ä¸­...',
                'status.saving': 'ä¿å­˜ä¸­...',
                'status.saved': 'å·²ä¿å­˜',
                'confirm.delete': 'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå£°éŸ³å—ï¼Ÿ',
                'error.micAccess': 'æ— æ³•è®¿é—®éº¦å…‹é£',
                'error.enterName': 'è¯·è¾“å…¥å£°éŸ³åç§°',
                'error.recordFirst': 'è¯·å…ˆå½•åˆ¶å‚è€ƒéŸ³é¢‘',
                'error.uploadFirst': 'è¯·å…ˆä¸Šä¼ å‚è€ƒéŸ³é¢‘',
                'error.saveFailed': 'ä¿å­˜å¤±è´¥',
                'error.deleteFailed': 'åˆ é™¤å¤±è´¥',
                'error.loadVoices': 'åŠ è½½å£°éŸ³åº“å¤±è´¥'
            },
            en: {
                subtitle: 'Text-to-Speech Service',
                'nav.demo': 'Demo',
                'nav.api': 'API Docs',
                'tab.preset': 'Preset Voices',
                'tab.design': 'Voice Design',
                'tab.clone': 'Voice Clone',
                'input.title': 'Input Text',
                'input.placeholder': 'Enter text to synthesize...',
                'settings.title': 'Voice Settings',
                'settings.speaker': 'Speaker',
                'settings.language': 'Language',
                'settings.instruct': 'Emotion Instruction (Optional)',
                'settings.instructPlaceholder': 'e.g., say it happily, speak with sadness',
                'btn.generate': 'Generate',
                'btn.generateVoice': 'Generate Voice',
                'btn.cloneGenerate': 'Clone & Generate',
                'btn.save': 'Save',
                'result.title': 'Result',
                'examples.title': 'Quick Examples:',
                'examples.chinese': 'Chinese',
                'examples.english': 'English',
                'examples.japanese': 'Japanese',
                'design.descTitle': 'Voice Description',
                'design.descPlaceholder': 'Describe the voice you want in natural language, e.g., a deep husky middle-aged male voice, a gentle sweet young female voice...',
                'design.quickSelect': 'Quick Select:',
                'design.matureMale': 'Mature Male',
                'design.sweetGirl': 'Sweet Girl',
                'design.loli': 'Cute Voice',
                'design.authoritative': 'Authoritative',
                'design.cheerful': 'Cheerful Female',
                'design.synthTitle': 'Synthesis Settings',
                'design.textLabel': 'Text to Synthesize',
                'clone.library': 'My Voice Library',
                'clone.noVoices': 'No saved voices',
                'clone.refAudio': 'Reference Audio',
                'clone.record': 'Record',
                'clone.stop': 'Stop',
                'clone.upload': 'Upload File',
                'clone.recording': 'Recording',
                'clone.clear': 'Clear',
                'clone.refTextLabel': 'Reference Audio Transcript (Optional, improves quality)',
                'clone.refTextPlaceholder': 'Enter what is said in the reference audio...',
                'clone.synthPlaceholder': 'Enter text to be spoken with cloned voice...',
                'clone.saveNamePlaceholder': 'Enter name to save to library',
                'api.title': 'API Documentation',
                'api.subtitle': 'Integrate text-to-speech capabilities into your applications via HTTP API',
                'api.presetTTS': 'Preset Speaker TTS',
                'api.voiceClone': 'Voice Cloning',
                'api.voiceLibrary': 'Voice Library',
                'api.otherEndpoints': 'Other Endpoints',
                'api.params': 'Parameters',
                'api.paramText': 'Text to synthesize',
                'api.paramSpeaker': 'Speaker name',
                'api.paramLang': 'Language',
                'api.paramInstruct': 'Emotion instruction (optional)',
                'api.paramAudio': 'Reference audio file (3-10s)',
                'api.paramRefText': 'Reference audio transcript (optional, improves quality)',
                'api.speakerList': 'Speaker List',
                'api.getVoices': 'Get saved voices list',
                'api.saveVoice': 'Save voice to library',
                'api.useSavedVoice': 'Generate with saved voice',
                'api.deleteVoice': 'Delete saved voice',
                'api.getSpeakers': 'Get available speakers',
                'api.getLanguages': 'Get supported languages',
                'status.loadingModel': 'Loading model, please wait...',
                'status.loadingModelTime': 'Loading model... ({0}s)',
                'status.modelLoaded': 'Model loaded',
                'status.modelLoadFailed': 'Model load failed, please refresh',
                'status.modelLoadTimeout': 'Model load timeout, please refresh',
                'status.generating': 'Generating...',
                'status.loadingModelBtn': 'Loading model...',
                'status.success': 'Success',
                'status.failed': 'Failed',
                'status.enterText': 'Please enter text to synthesize',
                'status.enterDesc': 'Please enter voice description',
                'status.needAudio': 'Please record audio or select from library',
                'status.needUpload': 'Please upload audio or select from library',
                'status.usingSaved': 'Generating with saved voice...',
                'status.cloning': 'Cloning voice...',
                'status.saving': 'Saving...',
                'status.saved': 'Saved',
                'confirm.delete': 'Are you sure you want to delete this voice?',
                'error.micAccess': 'Cannot access microphone',
                'error.enterName': 'Please enter a voice name',
                'error.recordFirst': 'Please record reference audio first',
                'error.uploadFirst': 'Please upload reference audio first',
                'error.saveFailed': 'Save failed',
                'error.deleteFailed': 'Delete failed',
                'error.loadVoices': 'Failed to load voice library'
            }
        };

        let currentLang = 'zh';

        function t(key, ...args) {
            let text = i18n[currentLang][key] || i18n['zh'][key] || key;
            args.forEach((arg, i) => {
                text = text.replace(`{${i}}`, arg);
            });
            return text;
        }

        function applyTranslations() {
            // æ›´æ–° data-i18n å…ƒç´ 
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                el.textContent = t(key);
            });
            // æ›´æ–° placeholder
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                el.placeholder = t(key);
            });
            // æ›´æ–°é¡µé¢æ ‡é¢˜
            document.title = 'Qwen3-TTS - ' + t('subtitle');
            // æ›´æ–°è¯­è¨€åˆ‡æ¢æŒ‰é’®
            document.getElementById('lang-label').textContent = currentLang === 'zh' ? 'ä¸­æ–‡ / EN' : 'EN / ä¸­æ–‡';
            document.documentElement.lang = currentLang === 'zh' ? 'zh-CN' : 'en';
        }

        function toggleLanguage() {
            currentLang = currentLang === 'zh' ? 'en' : 'zh';
            localStorage.setItem('vibevoice-lang', currentLang);
            applyTranslations();
        }

        function initLanguage() {
            // ä¼˜å…ˆè¯»å– localStorage
            const saved = localStorage.getItem('vibevoice-lang');
            if (saved && (saved === 'zh' || saved === 'en')) {
                currentLang = saved;
            } else {
                // è‡ªåŠ¨æ£€æµ‹æµè§ˆå™¨è¯­è¨€
                const browserLang = navigator.language || navigator.userLanguage;
                currentLang = browserLang.startsWith('zh') ? 'zh' : 'en';
            }
            applyTranslations();
        }

        // ==================== åº”ç”¨é€»è¾‘ ====================
        let selectedFile = null;
        let recordedBlob = null;
        let mediaRecorder = null;
        let audioChunks = [];
        let recordingStartTime = null;
        let timerInterval = null;
        let audioSource = 'record';
        let savedVoices = [];
        let selectedVoiceId = null;

        // æ¨¡å‹åŠ è½½çŠ¶æ€ç¼“å­˜
        let modelStatusCache = { custom: 'unloaded', design: 'unloaded', clone: 'unloaded' };

        // ç¡®ä¿æ¨¡å‹å·²åŠ è½½
        async function ensureModelLoaded(modelType, statusEl, btnEl) {
            // å…ˆæ£€æŸ¥çŠ¶æ€
            const statusRes = await fetch('/model/status');
            const statusData = await statusRes.json();
            modelStatusCache = statusData.status;

            if (modelStatusCache[modelType] === 'loaded') {
                return true;
            }

            // è§¦å‘åŠ è½½
            statusEl.textContent = t('status.loadingModel');
            statusEl.classList.remove('text-red-500');
            btnEl.innerHTML = '<span class="spinner"></span> ' + t('status.loadingModelBtn');

            await fetch(`/model/load/${modelType}`, { method: 'POST' });

            // è½®è¯¢ç­‰å¾…åŠ è½½å®Œæˆ
            let attempts = 0;
            const maxAttempts = 120; // æœ€å¤šç­‰å¾…2åˆ†é’Ÿ
            while (attempts < maxAttempts) {
                await new Promise(r => setTimeout(r, 1000)); // æ¯ç§’æ£€æŸ¥ä¸€æ¬¡
                const checkRes = await fetch('/model/status');
                const checkData = await checkRes.json();
                modelStatusCache = checkData.status;

                if (modelStatusCache[modelType] === 'loaded') {
                    statusEl.textContent = t('status.modelLoaded');
                    return true;
                } else if (modelStatusCache[modelType] === 'unloaded') {
                    // åŠ è½½å¤±è´¥
                    statusEl.textContent = t('status.modelLoadFailed');
                    statusEl.classList.add('text-red-500');
                    return false;
                }

                // æ›´æ–°è¿›åº¦æç¤º
                attempts++;
                statusEl.textContent = t('status.loadingModelTime', attempts);
            }

            statusEl.textContent = t('status.modelLoadTimeout');
            statusEl.classList.add('text-red-500');
            return false;
        }

        // é¡µé¢åŠ è½½
        document.addEventListener('DOMContentLoaded', () => {
            initLanguage();
            loadSavedVoices();
        });

        function switchPage(page) {
            // æ›´æ–°å¯¼èˆªæ ·å¼
            document.getElementById('nav-demo').className = page === 'demo'
                ? 'px-4 py-3 rounded-xl cursor-pointer flex items-center gap-3 transition-all bg-white shadow-sm text-charcoal font-medium'
                : 'px-4 py-3 rounded-xl cursor-pointer flex items-center gap-3 transition-all text-charcoal/70 hover:bg-warm-gray/50';
            document.getElementById('nav-api').className = page === 'api'
                ? 'px-4 py-3 rounded-xl cursor-pointer flex items-center gap-3 transition-all bg-white shadow-sm text-charcoal font-medium'
                : 'px-4 py-3 rounded-xl cursor-pointer flex items-center gap-3 transition-all text-charcoal/70 hover:bg-warm-gray/50';
            // åˆ‡æ¢é¡µé¢
            document.getElementById('page-demo').className = page === 'demo' ? 'max-w-3xl mx-auto' : 'hidden';
            document.getElementById('page-api').className = page === 'api' ? 'max-w-3xl mx-auto space-y-6' : 'hidden';
        }

        async function loadSavedVoices() {
            try {
                const response = await fetch('/voices');
                const data = await response.json();
                savedVoices = data.voices || [];
                renderVoiceList();
            } catch (error) {
                console.error(t('error.loadVoices') + ':', error);
            }
        }

        function renderVoiceList() {
            const container = document.getElementById('voice-list');
            if (savedVoices.length === 0) {
                container.innerHTML = `<div class="col-span-full text-center py-6 text-charcoal/40 text-sm">${t('clone.noVoices')}</div>`;
                return;
            }
            container.innerHTML = savedVoices.map(voice => `
                <div class="relative p-3 rounded-xl border-2 cursor-pointer transition-all ${selectedVoiceId === voice.id ? 'border-accent bg-accent/5' : 'border-warm-gray hover:border-accent/50'}"
                     onclick="selectVoice('${voice.id}')">
                    <div class="font-medium text-charcoal text-sm truncate pr-12">${voice.name}</div>
                    <div class="text-xs text-charcoal/50 mt-1">${voice.language}</div>
                    <div class="absolute top-2 right-2 flex gap-1">
                        <button onclick="event.stopPropagation(); previewVoice('${voice.id}')"
                            class="w-6 h-6 rounded bg-accent/10 text-accent text-xs flex items-center justify-center hover:bg-accent/20">â–¶</button>
                        <button onclick="event.stopPropagation(); deleteVoice('${voice.id}')"
                            class="w-6 h-6 rounded bg-red-50 text-red-400 text-xs flex items-center justify-center hover:bg-red-100">Ã—</button>
                    </div>
                </div>
            `).join('');
        }

        function selectVoice(voiceId) {
            selectedVoiceId = selectedVoiceId === voiceId ? null : voiceId;
            renderVoiceList();
        }

        async function previewVoice(voiceId) {
            const audio = document.getElementById('voice-preview-audio');
            audio.src = `/voices/${voiceId}/preview`;
            audio.play();
        }

        async function deleteVoice(voiceId) {
            if (!confirm(t('confirm.delete'))) return;
            try {
                const response = await fetch(`/voices/${voiceId}`, { method: 'DELETE' });
                if (response.ok) {
                    if (selectedVoiceId === voiceId) selectedVoiceId = null;
                    await loadSavedVoices();
                }
            } catch (error) {
                alert(t('error.deleteFailed') + ': ' + error.message);
            }
        }

        async function saveVoice() {
            const name = document.getElementById('voice-name').value.trim();
            const language = document.getElementById('language-clone').value;
            const refText = document.getElementById('ref-text').value.trim();

            if (!name) { alert(t('error.enterName')); return; }

            let audioFile = null;
            if (audioSource === 'record') {
                if (!recordedBlob) { alert(t('error.recordFirst')); return; }
                audioFile = new File([recordedBlob], 'recording.webm', { type: 'audio/webm' });
            } else {
                if (!selectedFile) { alert(t('error.uploadFirst')); return; }
                audioFile = selectedFile;
            }

            const formData = new FormData();
            formData.append('name', name);
            formData.append('language', language);
            formData.append('ref_text', refText);
            formData.append('audio', audioFile);

            const btn = document.querySelector('#audio-container-clone button:last-child');
            btn.disabled = true;
            btn.textContent = t('status.saving');

            try {
                const response = await fetch('/voices/save', { method: 'POST', body: formData });
                if (response.ok) {
                    document.getElementById('voice-name').value = '';
                    btn.textContent = t('status.saved');
                    await loadSavedVoices();
                    setTimeout(() => { btn.textContent = t('btn.save'); }, 2000);
                } else {
                    throw new Error((await response.json()).detail || t('error.saveFailed'));
                }
            } catch (error) {
                alert(t('error.saveFailed') + ': ' + error.message);
                btn.textContent = t('btn.save');
            } finally {
                btn.disabled = false;
            }
        }

        function switchTab(tab) {
            const activeClass = 'flex-1 px-6 py-3 rounded-xl font-medium transition-all bg-accent text-white';
            const inactiveClass = 'flex-1 px-6 py-3 rounded-xl font-medium transition-all bg-warm-gray text-charcoal/70 hover:bg-accent/20';
            document.getElementById('tab-custom').className = tab === 'custom' ? activeClass : inactiveClass;
            document.getElementById('tab-design').className = tab === 'design' ? activeClass : inactiveClass;
            document.getElementById('tab-clone').className = tab === 'clone' ? activeClass : inactiveClass;
            document.getElementById('panel-custom').className = tab === 'custom' ? 'space-y-5' : 'hidden space-y-5';
            document.getElementById('panel-design').className = tab === 'design' ? 'space-y-5' : 'hidden space-y-5';
            document.getElementById('panel-clone').className = tab === 'clone' ? 'space-y-5' : 'hidden space-y-5';
        }

        function setDesignExample(instruct) {
            document.getElementById('instruct-design').value = instruct;
        }

        async function generateDesign() {
            const text = document.getElementById('text-design').value.trim();
            const language = document.getElementById('language-design').value;
            const instruct = document.getElementById('instruct-design').value.trim();
            const btn = document.getElementById('btn-design');
            const status = document.getElementById('status-design');
            const container = document.getElementById('audio-container-design');
            const audio = document.getElementById('audio-design');

            if (!instruct) { status.textContent = t('status.enterDesc'); status.classList.add('text-red-500'); return; }
            if (!text) { status.textContent = t('status.enterText'); status.classList.add('text-red-500'); return; }

            btn.disabled = true;
            status.textContent = '';
            container.classList.add('hidden');

            // ç¡®ä¿æ¨¡å‹å·²åŠ è½½
            const modelReady = await ensureModelLoaded('design', status, btn);
            if (!modelReady) {
                btn.disabled = false;
                btn.textContent = t('btn.generateVoice');
                return;
            }

            btn.innerHTML = '<span class="spinner"></span> ' + t('status.generating');
            status.textContent = '';

            try {
                const formData = new FormData();
                formData.append('text', text);
                formData.append('language', language);
                formData.append('instruct', instruct);

                const response = await fetch('/design', { method: 'POST', body: formData });
                if (!response.ok) throw new Error((await response.json()).detail || t('status.failed'));

                audio.src = URL.createObjectURL(await response.blob());
                container.classList.remove('hidden');
                audio.play();
                status.textContent = t('status.success');
                status.classList.remove('text-red-500');
            } catch (error) {
                status.textContent = t('status.failed') + ': ' + error.message;
                status.classList.add('text-red-500');
            } finally {
                btn.disabled = false;
                btn.textContent = t('btn.generateVoice');
            }
        }

        async function toggleRecording() {
            const btn = document.getElementById('record-btn');
            const icon = document.getElementById('record-icon');
            const text = document.getElementById('record-text');
            const timerRow = document.getElementById('record-timer-row');
            const timer = document.getElementById('record-timer');

            if (!mediaRecorder || mediaRecorder.state === 'inactive') {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream, { mimeType: 'audio/webm' });
                    audioChunks = [];

                    mediaRecorder.ondataavailable = (e) => { if (e.data.size > 0) audioChunks.push(e.data); };
                    mediaRecorder.onstop = () => {
                        stream.getTracks().forEach(track => track.stop());
                        recordedBlob = new Blob(audioChunks, { type: 'audio/webm' });
                        selectedFile = null; // æ¸…é™¤ä¸Šä¼ çš„æ–‡ä»¶ï¼Œä½¿ç”¨å½•éŸ³
                        audioSource = 'record';
                        showAudioPreview(URL.createObjectURL(recordedBlob));
                        timerRow.classList.add('hidden');
                        icon.textContent = 'ğŸ™ï¸';
                        text.textContent = t('clone.record');
                        btn.classList.remove('bg-charcoal', 'hover:bg-charcoal/80');
                        btn.classList.add('bg-red-500', 'hover:bg-red-600');
                        clearInterval(timerInterval);
                    };

                    mediaRecorder.start();
                    recordingStartTime = Date.now();
                    icon.textContent = 'â¹';
                    text.textContent = t('clone.stop');
                    btn.classList.remove('bg-red-500', 'hover:bg-red-600');
                    btn.classList.add('bg-charcoal', 'hover:bg-charcoal/80');
                    timerRow.classList.remove('hidden');
                    timer.textContent = '00:00';

                    timerInterval = setInterval(() => {
                        const elapsed = Math.floor((Date.now() - recordingStartTime) / 1000);
                        timer.textContent = `${String(Math.floor(elapsed / 60)).padStart(2, '0')}:${String(elapsed % 60).padStart(2, '0')}`;
                    }, 100);
                } catch (err) {
                    alert(t('error.micAccess') + ': ' + err.message);
                }
            } else if (mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
            }
        }

        function handleFileSelect(input) {
            const file = input.files[0];
            if (file) {
                selectedFile = file;
                recordedBlob = null; // æ¸…é™¤å½•éŸ³ï¼Œä½¿ç”¨ä¸Šä¼ çš„æ–‡ä»¶
                audioSource = 'upload';
                showAudioPreview(URL.createObjectURL(file));
            }
        }

        function showAudioPreview(url) {
            const row = document.getElementById('audio-preview-row');
            const audio = document.getElementById('audio-preview');
            audio.src = url;
            row.classList.remove('hidden');
        }

        function clearAudio() {
            selectedFile = null;
            recordedBlob = null;
            document.getElementById('audio-preview-row').classList.add('hidden');
            document.getElementById('audio-preview').src = '';
            document.getElementById('ref-audio').value = '';
            if (mediaRecorder?.state === 'recording') mediaRecorder.stop();
            mediaRecorder = null;
            clearInterval(timerInterval);
        }

        async function generateCustom() {
            const text = document.getElementById('text-custom').value.trim();
            const speaker = document.getElementById('speaker').value;
            const language = document.getElementById('language-custom').value;
            const instruct = document.getElementById('instruct').value.trim();
            const btn = document.getElementById('btn-custom');
            const status = document.getElementById('status-custom');
            const container = document.getElementById('audio-container-custom');
            const audio = document.getElementById('audio-custom');

            if (!text) { status.textContent = t('status.enterText'); status.classList.add('text-red-500'); return; }

            btn.disabled = true;
            status.textContent = '';
            container.classList.add('hidden');

            // ç¡®ä¿æ¨¡å‹å·²åŠ è½½
            const modelReady = await ensureModelLoaded('custom', status, btn);
            if (!modelReady) {
                btn.disabled = false;
                btn.textContent = t('btn.generate');
                return;
            }

            btn.innerHTML = '<span class="spinner"></span> ' + t('status.generating');
            status.textContent = '';

            try {
                const params = new URLSearchParams({ text, speaker, language });
                if (instruct) params.append('instruct', instruct);
                const response = await fetch(`/tts?${params.toString()}`);
                if (!response.ok) throw new Error(t('status.failed'));

                audio.src = URL.createObjectURL(await response.blob());
                container.classList.remove('hidden');
                audio.play();
                status.textContent = t('status.success');
                status.classList.remove('text-red-500');
            } catch (error) {
                status.textContent = t('status.failed') + ': ' + error.message;
                status.classList.add('text-red-500');
            } finally {
                btn.disabled = false;
                btn.textContent = t('btn.generate');
            }
        }


        async function generateClone() {
            const text = document.getElementById('text-clone').value.trim();
            const language = document.getElementById('language-clone').value;
            const refText = document.getElementById('ref-text').value.trim();
            const btn = document.getElementById('btn-clone');
            const status = document.getElementById('status-clone');
            const container = document.getElementById('audio-container-clone');
            const audio = document.getElementById('audio-clone');

            if (!text) { status.textContent = t('status.enterText'); status.classList.add('text-red-500'); return; }

            btn.disabled = true;
            status.textContent = '';
            container.classList.add('hidden');

            // ç¡®ä¿æ¨¡å‹å·²åŠ è½½
            const modelReady = await ensureModelLoaded('clone', status, btn);
            if (!modelReady) {
                btn.disabled = false;
                btn.textContent = t('btn.cloneGenerate');
                return;
            }

            try {
                let response;
                if (selectedVoiceId) {
                    btn.innerHTML = '<span class="spinner"></span> ' + t('status.usingSaved');
                    const formData = new FormData();
                    formData.append('text', text);
                    formData.append('language', language);
                    response = await fetch(`/voices/${selectedVoiceId}/tts`, { method: 'POST', body: formData });
                } else {
                    let audioFile = null;
                    if (audioSource === 'record') {
                        if (!recordedBlob) { status.textContent = t('status.needAudio'); status.classList.add('text-red-500'); btn.disabled = false; btn.textContent = t('btn.cloneGenerate'); return; }
                        audioFile = new File([recordedBlob], 'recording.webm', { type: 'audio/webm' });
                    } else {
                        if (!selectedFile) { status.textContent = t('status.needUpload'); status.classList.add('text-red-500'); btn.disabled = false; btn.textContent = t('btn.cloneGenerate'); return; }
                        audioFile = selectedFile;
                    }
                    btn.innerHTML = '<span class="spinner"></span> ' + t('status.cloning');
                    const formData = new FormData();
                    formData.append('audio', audioFile);
                    formData.append('text', text);
                    formData.append('language', language);
                    formData.append('ref_text', refText);
                    response = await fetch('/clone', { method: 'POST', body: formData });
                }

                if (!response.ok) throw new Error((await response.json()).detail || t('status.failed'));

                audio.src = URL.createObjectURL(await response.blob());
                container.classList.remove('hidden');
                audio.play();
                status.textContent = t('status.success');
                status.classList.remove('text-red-500');
            } catch (error) {
                status.textContent = t('status.failed') + ': ' + error.message;
                status.classList.add('text-red-500');
            } finally {
                btn.disabled = false;
                btn.textContent = t('btn.cloneGenerate');
            }
        }

        function setCustomExample(text, speaker, language) {
            document.getElementById('text-custom').value = text;
            document.getElementById('speaker').value = speaker;
            document.getElementById('language-custom').value = language;
        }
    </script>
</body>
</html>
